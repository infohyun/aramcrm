<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MEMORY - Neural Link</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

*{margin:0;padding:0;box-sizing:border-box;}

:root{
  --cyan:#00f0ff;
  --purple:#a855f7;
  --gold:#f59e0b;
  --red:#ef4444;
  --green:#22c55e;
  --bg:#05050f;
  --glass:rgba(255,255,255,0.02);
  --glass-border:rgba(255,255,255,0.06);
  --text:#e2e8f0;
  --text-dim:rgba(255,255,255,0.35);
}

html{scroll-behavior:smooth;}

body{
  font-family:'Rajdhani',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  position:relative;
}

#starCanvas{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:0;
  pointer-events:none;
}

.back-link{
  position:fixed;
  top:20px;left:20px;
  z-index:100;
  display:flex;align-items:center;gap:8px;
  padding:10px 20px;
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:12px;
  color:var(--text-dim);
  text-decoration:none;
  font-family:'Rajdhani',sans-serif;
  font-size:15px;font-weight:500;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  transition:all .3s ease;
}
.back-link:hover{
  color:var(--cyan);
  border-color:rgba(0,240,255,0.3);
  box-shadow:0 0 20px rgba(0,240,255,0.1);
}
.back-link svg{width:16px;height:16px;transition:transform .3s ease;}
.back-link:hover svg{transform:translateX(-3px);}

.container{
  position:relative;z-index:1;
  max-width:900px;
  margin:0 auto;
  padding:20px;
  min-height:100vh;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
}

/* ---- TITLE ---- */
.game-header{
  text-align:center;
  margin-bottom:24px;
  user-select:none;
}
.game-title{
  font-family:'Orbitron',monospace;
  font-size:clamp(36px,7vw,56px);
  font-weight:900;
  letter-spacing:8px;
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  text-shadow:none;
  filter:drop-shadow(0 0 30px rgba(0,240,255,0.3));
  line-height:1.1;
}
.game-subtitle{
  font-family:'Orbitron',monospace;
  font-size:clamp(11px,2vw,14px);
  letter-spacing:12px;
  color:var(--purple);
  opacity:.7;
  margin-top:4px;
}

/* ---- MENU SCREEN ---- */
#menuScreen{
  display:flex;flex-direction:column;
  align-items:center;gap:24px;
  width:100%;max-width:460px;
}
.menu-panel{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:20px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  padding:32px;
  width:100%;
  text-align:center;
}
.menu-panel h2{
  font-family:'Orbitron',monospace;
  font-size:16px;letter-spacing:4px;
  color:var(--cyan);opacity:.8;
  margin-bottom:20px;
}
.diff-buttons{
  display:flex;flex-direction:column;gap:12px;
}
.diff-btn{
  position:relative;
  padding:16px 24px;
  background:rgba(255,255,255,0.03);
  border:1px solid var(--glass-border);
  border-radius:14px;
  color:var(--text);
  font-family:'Rajdhani',sans-serif;
  font-size:18px;font-weight:600;
  cursor:pointer;
  transition:all .3s ease;
  display:flex;align-items:center;justify-content:space-between;
  overflow:hidden;
}
.diff-btn::before{
  content:'';position:absolute;
  top:0;left:0;width:100%;height:100%;
  opacity:0;transition:opacity .3s ease;
}
.diff-btn[data-diff="easy"]::before{background:linear-gradient(135deg,rgba(34,197,94,0.1),transparent);}
.diff-btn[data-diff="medium"]::before{background:linear-gradient(135deg,rgba(0,240,255,0.1),transparent);}
.diff-btn[data-diff="hard"]::before{background:linear-gradient(135deg,rgba(239,68,68,0.1),transparent);}
.diff-btn:hover::before{opacity:1;}
.diff-btn:hover{border-color:rgba(255,255,255,0.15);transform:translateY(-2px);}
.diff-btn .diff-label{font-family:'Orbitron',monospace;font-size:14px;letter-spacing:2px;}
.diff-btn .diff-info{font-size:14px;color:var(--text-dim);}
.diff-btn[data-diff="easy"] .diff-label{color:var(--green);}
.diff-btn[data-diff="medium"] .diff-label{color:var(--cyan);}
.diff-btn[data-diff="hard"] .diff-label{color:var(--red);}

/* Best Scores */
.best-scores{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:20px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  padding:24px;width:100%;
}
.best-scores h3{
  font-family:'Orbitron',monospace;
  font-size:12px;letter-spacing:4px;
  color:var(--gold);opacity:.7;
  margin-bottom:16px;text-align:center;
}
.score-row{
  display:flex;justify-content:space-between;align-items:center;
  padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.04);
}
.score-row:last-child{border-bottom:none;}
.score-row .lbl{font-size:14px;color:var(--text-dim);}
.score-row .val{font-family:'Orbitron',monospace;font-size:13px;color:var(--cyan);}

/* ---- GAME SCREEN ---- */
#gameScreen{display:none;width:100%;max-width:860px;}

/* HUD */
.hud{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:20px;
  flex-wrap:wrap;gap:12px;
}
.hud-item{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:14px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  padding:10px 18px;
  display:flex;align-items:center;gap:10px;
  min-width:120px;
}
.hud-label{
  font-family:'Orbitron',monospace;
  font-size:10px;letter-spacing:2px;
  color:var(--text-dim);
  text-transform:uppercase;
}
.hud-value{
  font-family:'Orbitron',monospace;
  font-size:20px;font-weight:700;
  color:var(--cyan);
}
.hud-stars{display:flex;gap:4px;}
.hud-star{
  width:20px;height:20px;
  transition:all .3s ease;
}
.hud-star.active{filter:drop-shadow(0 0 6px var(--gold));}
.hud-star.inactive{opacity:.2;}

.hud-btn{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:12px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  padding:10px 16px;
  color:var(--text-dim);
  cursor:pointer;
  font-family:'Rajdhani',sans-serif;
  font-size:14px;font-weight:600;
  transition:all .3s ease;
  display:flex;align-items:center;gap:6px;
}
.hud-btn:hover{color:var(--cyan);border-color:rgba(0,240,255,0.3);}

/* ---- CARD GRID ---- */
.card-grid{
  display:grid;
  gap:12px;
  justify-content:center;
  perspective:1200px;
}
.card-grid.easy{grid-template-columns:repeat(4,1fr);}
.card-grid.medium{grid-template-columns:repeat(4,1fr);}
.card-grid.hard{grid-template-columns:repeat(6,1fr);}

/* ---- CARD ---- */
.card{
  position:relative;
  aspect-ratio:3/4;
  cursor:pointer;
  perspective:800px;
  min-width:0;
}
.card-inner{
  position:relative;
  width:100%;height:100%;
  transition:transform .5s cubic-bezier(.4,.2,.2,1);
  transform-style:preserve-3d;
}
.card.flipped .card-inner{transform:rotateY(180deg);}
.card.matched .card-inner{transform:rotateY(180deg);}

.card-face{
  position:absolute;
  width:100%;height:100%;
  backface-visibility:hidden;
  -webkit-backface-visibility:hidden;
  border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}

/* CARD BACK */
.card-back{
  background:linear-gradient(145deg,rgba(10,10,30,0.9),rgba(5,5,20,0.95));
  border:1px solid rgba(0,240,255,0.12);
  box-shadow:inset 0 0 40px rgba(0,240,255,0.03),0 4px 20px rgba(0,0,0,0.4);
}
.card-back-pattern{
  width:100%;height:100%;
  position:relative;
  display:flex;align-items:center;justify-content:center;
}
.card-back-pattern svg{
  width:50%;height:50%;
  opacity:.25;
}

/* CARD FRONT */
.card-front{
  background:linear-gradient(145deg,rgba(15,15,40,0.95),rgba(5,5,20,0.98));
  border:1px solid rgba(255,255,255,0.08);
  transform:rotateY(180deg);
  box-shadow:inset 0 0 30px rgba(0,0,0,0.3);
}
.card-front svg{
  width:55%;height:55%;
  filter:drop-shadow(0 0 12px currentColor);
  transition:all .3s ease;
}

/* MATCHED EFFECT */
.card.matched .card-front{
  border-color:rgba(34,197,94,0.4);
  box-shadow:0 0 25px rgba(34,197,94,0.15),inset 0 0 25px rgba(34,197,94,0.05);
}
.card.matched{pointer-events:none;}

@keyframes matchPulse{
  0%{box-shadow:0 0 0 0 rgba(34,197,94,0.4);}
  70%{box-shadow:0 0 0 12px rgba(34,197,94,0);}
  100%{box-shadow:0 0 0 0 rgba(34,197,94,0);}
}
.card.match-anim .card-front{animation:matchPulse .8s ease-out;}

@keyframes cardShake{
  0%,100%{transform:rotateY(180deg) translateX(0);}
  20%{transform:rotateY(180deg) translateX(-6px);}
  40%{transform:rotateY(180deg) translateX(6px);}
  60%{transform:rotateY(180deg) translateX(-4px);}
  80%{transform:rotateY(180deg) translateX(4px);}
}
.card.shake .card-inner{animation:cardShake .4s ease-in-out;}

/* ---- WIN OVERLAY ---- */
#winOverlay{
  display:none;
  position:fixed;top:0;left:0;
  width:100%;height:100%;
  z-index:200;
  align-items:center;justify-content:center;
  background:rgba(5,5,15,0.85);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
}
#winOverlay.show{display:flex;}
#particleCanvas{
  position:absolute;top:0;left:0;
  width:100%;height:100%;
  pointer-events:none;
}
.win-panel{
  position:relative;z-index:1;
  background:var(--glass);
  border:1px solid rgba(0,240,255,0.15);
  border-radius:24px;
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  padding:48px 40px;
  text-align:center;
  max-width:420px;width:90%;
  animation:winSlideIn .6s cubic-bezier(.16,1,.3,1);
}
@keyframes winSlideIn{
  from{opacity:0;transform:translateY(40px) scale(.95);}
  to{opacity:1;transform:translateY(0) scale(1);}
}
.win-title{
  font-family:'Orbitron',monospace;
  font-size:32px;font-weight:900;
  letter-spacing:4px;
  background:linear-gradient(135deg,var(--cyan),var(--gold));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:8px;
}
.win-subtitle{
  font-size:16px;color:var(--text-dim);
  margin-bottom:28px;
}
.win-stars{
  display:flex;justify-content:center;gap:8px;
  margin-bottom:28px;
}
.win-star{width:40px;height:40px;}
.win-star.active{filter:drop-shadow(0 0 10px var(--gold));animation:starPop .5s ease backwards;}
.win-star.inactive{opacity:.15;}
.win-star:nth-child(2).active{animation-delay:.15s;}
.win-star:nth-child(3).active{animation-delay:.3s;}
@keyframes starPop{
  from{transform:scale(0) rotate(-30deg);opacity:0;}
  to{transform:scale(1) rotate(0);opacity:1;}
}
.win-stats{
  display:grid;grid-template-columns:1fr 1fr;gap:16px;
  margin-bottom:32px;
}
.win-stat{
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.05);
  border-radius:14px;padding:16px;
}
.win-stat-label{
  font-family:'Orbitron',monospace;
  font-size:10px;letter-spacing:2px;
  color:var(--text-dim);margin-bottom:6px;
}
.win-stat-value{
  font-family:'Orbitron',monospace;
  font-size:22px;font-weight:700;
  color:var(--cyan);
}
.win-stat-value.gold{color:var(--gold);}
.win-buttons{display:flex;flex-direction:column;gap:10px;}
.win-btn{
  padding:14px 24px;
  border-radius:14px;
  font-family:'Rajdhani',sans-serif;
  font-size:16px;font-weight:600;
  cursor:pointer;
  transition:all .3s ease;
  border:none;
}
.win-btn.primary{
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  color:#05050f;
}
.win-btn.primary:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,240,255,0.3);}
.win-btn.secondary{
  background:var(--glass);
  border:1px solid var(--glass-border);
  color:var(--text);
}
.win-btn.secondary:hover{border-color:rgba(255,255,255,0.15);transform:translateY(-2px);}

/* ---- RESPONSIVE ---- */
@media(max-width:600px){
  .container{padding:12px;padding-top:60px;}
  .game-title{letter-spacing:4px;}
  .game-subtitle{letter-spacing:6px;}
  .card-grid{gap:8px;}
  .card-grid.hard{grid-template-columns:repeat(4,1fr);}
  .hud{gap:8px;}
  .hud-item{padding:8px 12px;min-width:0;flex:1;}
  .hud-value{font-size:16px;}
  .win-panel{padding:32px 24px;}
  .menu-panel{padding:24px;}
}
@media(max-width:400px){
  .card-grid.hard{grid-template-columns:repeat(4,1fr);}
  .card-grid{gap:6px;}
}
</style>
</head>
<body>

<canvas id="starCanvas"></canvas>

<a href="/games.html" class="back-link">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
  ARCADE
</a>

<div class="container">
  <div class="game-header">
    <div class="game-title">MEMORY</div>
    <div class="game-subtitle">NEURAL LINK</div>
  </div>

  <!-- MENU -->
  <div id="menuScreen">
    <div class="menu-panel">
      <h2>SELECT MODE</h2>
      <div class="diff-buttons">
        <button class="diff-btn" data-diff="easy" onclick="startGame('easy')">
          <span class="diff-label">EASY</span>
          <span class="diff-info">4 x 3 &middot; 6 pairs</span>
        </button>
        <button class="diff-btn" data-diff="medium" onclick="startGame('medium')">
          <span class="diff-label">MEDIUM</span>
          <span class="diff-info">4 x 4 &middot; 8 pairs</span>
        </button>
        <button class="diff-btn" data-diff="hard" onclick="startGame('hard')">
          <span class="diff-label">HARD</span>
          <span class="diff-info">6 x 4 &middot; 12 pairs</span>
        </button>
      </div>
    </div>
    <div class="best-scores" id="bestScoresPanel">
      <h3>BEST SCORES</h3>
      <div id="bestScoresList"></div>
    </div>
  </div>

  <!-- GAME -->
  <div id="gameScreen">
    <div class="hud">
      <div class="hud-item">
        <div>
          <div class="hud-label">MOVES</div>
          <div class="hud-value" id="moveCount">0</div>
        </div>
      </div>
      <div class="hud-item">
        <div>
          <div class="hud-label">TIME</div>
          <div class="hud-value" id="timerDisplay">0:00</div>
        </div>
      </div>
      <div class="hud-item">
        <div>
          <div class="hud-label">RATING</div>
          <div class="hud-stars" id="starRating"></div>
        </div>
      </div>
      <button class="hud-btn" onclick="restartGame()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        RESTART
      </button>
      <button class="hud-btn" onclick="backToMenu()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        MENU
      </button>
    </div>
    <div class="card-grid" id="cardGrid"></div>
  </div>
</div>

<!-- WIN OVERLAY -->
<div id="winOverlay">
  <canvas id="particleCanvas"></canvas>
  <div class="win-panel">
    <div class="win-title">COMPLETE</div>
    <div class="win-subtitle">Neural link synchronized</div>
    <div class="win-stars" id="winStars"></div>
    <div class="win-stats">
      <div class="win-stat">
        <div class="win-stat-label">TIME</div>
        <div class="win-stat-value" id="winTime">0:00</div>
      </div>
      <div class="win-stat">
        <div class="win-stat-label">MOVES</div>
        <div class="win-stat-value" id="winMoves">0</div>
      </div>
      <div class="win-stat">
        <div class="win-stat-label">RATING</div>
        <div class="win-stat-value gold" id="winRating">---</div>
      </div>
      <div class="win-stat">
        <div class="win-stat-label">BEST</div>
        <div class="win-stat-value" id="winBest">---</div>
      </div>
    </div>
    <div class="win-buttons">
      <button class="win-btn primary" onclick="restartGame()">PLAY AGAIN</button>
      <button class="win-btn secondary" onclick="backToMenu()">BACK TO MENU</button>
    </div>
  </div>
</div>

<script>
// ===================== AUDIO ENGINE =====================
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function ensureAudio(){if(!audioCtx)audioCtx=new AudioCtx();}

function playTone(freq,dur,type='sine',vol=0.12,detune=0){
  ensureAudio();
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type=type;o.frequency.value=freq;o.detune.value=detune;
  g.gain.setValueAtTime(vol,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
  o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+dur);
}

function sfxFlip(){
  playTone(800,0.08,'sine',0.08);
  playTone(1200,0.06,'sine',0.05);
}
function sfxMatch(){
  playTone(523,0.12,'sine',0.1);
  setTimeout(()=>playTone(659,0.12,'sine',0.1),80);
  setTimeout(()=>playTone(784,0.18,'sine',0.12),160);
}
function sfxMismatch(){
  playTone(300,0.15,'sawtooth',0.06);
  setTimeout(()=>playTone(250,0.2,'sawtooth',0.05),100);
}
function sfxWin(){
  const notes=[523,659,784,1047];
  notes.forEach((n,i)=>{
    setTimeout(()=>{playTone(n,0.25,'sine',0.1);playTone(n*1.5,0.2,'triangle',0.05);},i*120);
  });
}

// ===================== STAR BACKGROUND =====================
(function initStars(){
  const c=document.getElementById('starCanvas');
  const ctx=c.getContext('2d');
  let stars=[];
  function resize(){c.width=window.innerWidth;c.height=window.innerHeight;initField();}
  function initField(){
    stars=[];
    const count=Math.floor((c.width*c.height)/3000);
    for(let i=0;i<count;i++){
      stars.push({
        x:Math.random()*c.width,
        y:Math.random()*c.height,
        r:Math.random()*1.2+0.2,
        a:Math.random()*0.6+0.1,
        speed:Math.random()*0.3+0.05,
        phase:Math.random()*Math.PI*2
      });
    }
  }
  window.addEventListener('resize',resize);
  resize();
  let t=0;
  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    t+=0.01;
    for(const s of stars){
      const flicker=0.5+0.5*Math.sin(t*s.speed*10+s.phase);
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fillStyle=`rgba(180,200,255,${s.a*flicker})`;
      ctx.fill();
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

// ===================== SYMBOL DEFINITIONS =====================
const SYMBOLS=[
  {name:'circle',color:'#00f0ff',
    svg:`<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="36" fill="none" stroke="#00f0ff" stroke-width="4"/><circle cx="50" cy="50" r="20" fill="none" stroke="#00f0ff" stroke-width="2" opacity=".5"/><circle cx="50" cy="50" r="6" fill="#00f0ff"/></svg>`},
  {name:'triangle',color:'#a855f7',
    svg:`<svg viewBox="0 0 100 100"><polygon points="50,14 88,82 12,82" fill="none" stroke="#a855f7" stroke-width="4" stroke-linejoin="round"/><polygon points="50,32 72,72 28,72" fill="none" stroke="#a855f7" stroke-width="2" opacity=".5" stroke-linejoin="round"/></svg>`},
  {name:'square',color:'#f59e0b',
    svg:`<svg viewBox="0 0 100 100"><rect x="18" y="18" width="64" height="64" rx="4" fill="none" stroke="#f59e0b" stroke-width="4"/><rect x="32" y="32" width="36" height="36" rx="2" fill="none" stroke="#f59e0b" stroke-width="2" opacity=".5"/></svg>`},
  {name:'diamond',color:'#ec4899',
    svg:`<svg viewBox="0 0 100 100"><polygon points="50,10 90,50 50,90 10,50" fill="none" stroke="#ec4899" stroke-width="4" stroke-linejoin="round"/><polygon points="50,28 72,50 50,72 28,50" fill="none" stroke="#ec4899" stroke-width="2" opacity=".5" stroke-linejoin="round"/></svg>`},
  {name:'hexagon',color:'#22c55e',
    svg:`<svg viewBox="0 0 100 100"><polygon points="50,8 89,29 89,71 50,92 11,71 11,29" fill="none" stroke="#22c55e" stroke-width="4" stroke-linejoin="round"/><polygon points="50,24 73,36 73,64 50,76 27,64 27,36" fill="none" stroke="#22c55e" stroke-width="2" opacity=".5" stroke-linejoin="round"/></svg>`},
  {name:'star',color:'#f59e0b',
    svg:`<svg viewBox="0 0 100 100"><polygon points="50,8 61,38 93,38 67,56 76,88 50,70 24,88 33,56 7,38 39,38" fill="none" stroke="#f59e0b" stroke-width="3.5" stroke-linejoin="round"/><circle cx="50" cy="50" r="10" fill="none" stroke="#f59e0b" stroke-width="2" opacity=".5"/></svg>`},
  {name:'pentagon',color:'#3b82f6',
    svg:`<svg viewBox="0 0 100 100"><polygon points="50,10 93,40 76,88 24,88 7,40" fill="none" stroke="#3b82f6" stroke-width="4" stroke-linejoin="round"/><polygon points="50,28 76,48 66,78 34,78 24,48" fill="none" stroke="#3b82f6" stroke-width="2" opacity=".5" stroke-linejoin="round"/></svg>`},
  {name:'cross',color:'#ef4444',
    svg:`<svg viewBox="0 0 100 100"><line x1="50" y1="12" x2="50" y2="88" stroke="#ef4444" stroke-width="4" stroke-linecap="round"/><line x1="12" y1="50" x2="88" y2="50" stroke="#ef4444" stroke-width="4" stroke-linecap="round"/><circle cx="50" cy="50" r="16" fill="none" stroke="#ef4444" stroke-width="2" opacity=".5"/></svg>`},
  {name:'bolt',color:'#fbbf24',
    svg:`<svg viewBox="0 0 100 100"><polygon points="58,8 28,52 46,52 42,92 72,48 54,48" fill="none" stroke="#fbbf24" stroke-width="3.5" stroke-linejoin="round"/></svg>`},
  {name:'eye',color:'#06b6d4',
    svg:`<svg viewBox="0 0 100 100"><ellipse cx="50" cy="50" rx="38" ry="22" fill="none" stroke="#06b6d4" stroke-width="3.5"/><circle cx="50" cy="50" r="12" fill="none" stroke="#06b6d4" stroke-width="3"/><circle cx="50" cy="50" r="4" fill="#06b6d4"/></svg>`},
  {name:'wave',color:'#8b5cf6',
    svg:`<svg viewBox="0 0 100 100"><path d="M10,50 Q25,20 40,50 Q55,80 70,50 Q85,20 95,50" fill="none" stroke="#8b5cf6" stroke-width="4" stroke-linecap="round"/><path d="M10,65 Q25,45 40,65 Q55,85 70,65 Q85,45 95,65" fill="none" stroke="#8b5cf6" stroke-width="2" opacity=".4" stroke-linecap="round"/></svg>`},
  {name:'atom',color:'#14b8a6',
    svg:`<svg viewBox="0 0 100 100"><ellipse cx="50" cy="50" rx="36" ry="14" fill="none" stroke="#14b8a6" stroke-width="2.5" transform="rotate(0,50,50)"/><ellipse cx="50" cy="50" rx="36" ry="14" fill="none" stroke="#14b8a6" stroke-width="2.5" transform="rotate(60,50,50)"/><ellipse cx="50" cy="50" rx="36" ry="14" fill="none" stroke="#14b8a6" stroke-width="2.5" transform="rotate(120,50,50)"/><circle cx="50" cy="50" r="5" fill="#14b8a6"/></svg>`}
];

const CARD_BACK_SVG=`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <rect x="10" y="10" width="80" height="80" rx="6" fill="none" stroke="rgba(0,240,255,0.2)" stroke-width="1.5"/>
  <line x1="10" y1="10" x2="90" y2="90" stroke="rgba(0,240,255,0.08)" stroke-width="1"/>
  <line x1="90" y1="10" x2="10" y2="90" stroke="rgba(0,240,255,0.08)" stroke-width="1"/>
  <circle cx="50" cy="50" r="18" fill="none" stroke="rgba(0,240,255,0.15)" stroke-width="1.5"/>
  <circle cx="50" cy="50" r="4" fill="rgba(0,240,255,0.2)"/>
  <rect x="30" y="30" width="40" height="40" rx="4" fill="none" stroke="rgba(0,240,255,0.08)" stroke-width="1" transform="rotate(45,50,50)"/>
</svg>`;

function starSVG(active){
  const col=active?'#f59e0b':'#f59e0b';
  return `<svg class="hud-star ${active?'active':'inactive'}" viewBox="0 0 24 24" fill="${active?col:'none'}" stroke="${col}" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>`;
}
function winStarSVG(active){
  const col=active?'#f59e0b':'#f59e0b';
  return `<svg class="win-star ${active?'active':'inactive'}" viewBox="0 0 24 24" fill="${active?col:'none'}" stroke="${col}" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>`;
}

// ===================== GAME STATE =====================
const DIFFICULTY={
  easy:{cols:4,rows:3,pairs:6},
  medium:{cols:4,rows:4,pairs:8},
  hard:{cols:6,rows:4,pairs:12}
};

let currentDiff='medium';
let cards=[];
let flippedCards=[];
let matchedPairs=0;
let totalPairs=0;
let moves=0;
let timerInterval=null;
let seconds=0;
let lockBoard=false;
let gameStarted=false;

// ===================== BEST SCORES =====================
function getScores(){
  try{return JSON.parse(localStorage.getItem('memory_scores'))||{};}
  catch(e){return {};}
}
function saveScore(diff,m,t){
  const scores=getScores();
  if(!scores[diff]||m<scores[diff].moves||(m===scores[diff].moves&&t<scores[diff].time)){
    scores[diff]={moves:m,time:t};
    localStorage.setItem('memory_scores',JSON.stringify(scores));
    return true;
  }
  return false;
}
function renderBestScores(){
  const scores=getScores();
  const el=document.getElementById('bestScoresList');
  let html='';
  ['easy','medium','hard'].forEach(d=>{
    const s=scores[d];
    const label=d.charAt(0).toUpperCase()+d.slice(1);
    html+=`<div class="score-row"><span class="lbl">${label}</span><span class="val">${s?s.moves+' moves / '+formatTime(s.time):'---'}</span></div>`;
  });
  el.innerHTML=html;
}

function formatTime(s){
  const m=Math.floor(s/60);
  const sec=s%60;
  return m+':'+(sec<10?'0':'')+sec;
}

// ===================== STAR RATING =====================
function getStars(moves,pairs){
  const ratio=moves/pairs;
  if(ratio<=2)return 3;
  if(ratio<=3)return 2;
  return 1;
}
function updateStars(){
  const s=getStars(moves,totalPairs);
  const el=document.getElementById('starRating');
  el.innerHTML=starSVG(s>=1)+starSVG(s>=2)+starSVG(s>=3);
}

// ===================== TIMER =====================
function startTimer(){
  if(timerInterval)return;
  timerInterval=setInterval(()=>{
    seconds++;
    document.getElementById('timerDisplay').textContent=formatTime(seconds);
  },1000);
}
function stopTimer(){clearInterval(timerInterval);timerInterval=null;}
function resetTimer(){
  stopTimer();seconds=0;
  document.getElementById('timerDisplay').textContent='0:00';
}

// ===================== SHUFFLE =====================
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// ===================== BUILD GRID =====================
function buildGrid(diff){
  const cfg=DIFFICULTY[diff];
  const grid=document.getElementById('cardGrid');
  grid.className='card-grid '+diff;
  grid.innerHTML='';

  const symbols=shuffle([...SYMBOLS]).slice(0,cfg.pairs);
  let cardData=[];
  symbols.forEach((sym,i)=>{
    cardData.push({id:i,symbol:sym});
    cardData.push({id:i,symbol:sym});
  });
  shuffle(cardData);

  cards=[];
  cardData.forEach((data,idx)=>{
    const card=document.createElement('div');
    card.className='card';
    card.dataset.id=data.id;
    card.dataset.idx=idx;
    card.innerHTML=`
      <div class="card-inner">
        <div class="card-face card-back">
          <div class="card-back-pattern">${CARD_BACK_SVG}</div>
        </div>
        <div class="card-face card-front" style="color:${data.symbol.color}">
          ${data.symbol.svg}
        </div>
      </div>`;
    card.addEventListener('click',()=>flipCard(card));
    card.addEventListener('touchend',(e)=>{e.preventDefault();flipCard(card);},{passive:false});
    grid.appendChild(card);
    cards.push(card);
  });
}

// ===================== FLIP LOGIC =====================
function flipCard(card){
  if(lockBoard)return;
  if(card.classList.contains('flipped'))return;
  if(card.classList.contains('matched'))return;
  if(flippedCards.length>=2)return;

  if(!gameStarted){gameStarted=true;startTimer();}

  sfxFlip();
  card.classList.add('flipped');
  flippedCards.push(card);

  if(flippedCards.length===2){
    moves++;
    document.getElementById('moveCount').textContent=moves;
    updateStars();
    checkMatch();
  }
}

function checkMatch(){
  const [a,b]=flippedCards;
  if(a.dataset.id===b.dataset.id){
    // MATCH
    lockBoard=true;
    setTimeout(()=>{
      a.classList.add('matched','match-anim');
      b.classList.add('matched','match-anim');
      sfxMatch();
      matchedPairs++;
      flippedCards=[];
      lockBoard=false;
      if(matchedPairs===totalPairs){
        stopTimer();
        setTimeout(showWin,600);
      }
    },400);
  }else{
    // MISMATCH
    lockBoard=true;
    setTimeout(()=>{
      sfxMismatch();
      a.classList.add('shake');
      b.classList.add('shake');
      setTimeout(()=>{
        a.classList.remove('flipped','shake');
        b.classList.remove('flipped','shake');
        flippedCards=[];
        lockBoard=false;
      },450);
    },700);
  }
}

// ===================== WIN =====================
function showWin(){
  sfxWin();
  const stars=getStars(moves,totalPairs);
  const isNew=saveScore(currentDiff,moves,seconds);

  document.getElementById('winTime').textContent=formatTime(seconds);
  document.getElementById('winMoves').textContent=moves;
  document.getElementById('winRating').textContent=stars===3?'PERFECT':stars===2?'GREAT':'GOOD';

  const scores=getScores();
  const best=scores[currentDiff];
  document.getElementById('winBest').textContent=best?best.moves+' / '+formatTime(best.time):'---';

  const ws=document.getElementById('winStars');
  ws.innerHTML=winStarSVG(stars>=1)+winStarSVG(stars>=2)+winStarSVG(stars>=3);

  const overlay=document.getElementById('winOverlay');
  overlay.classList.add('show');
  startParticles();
}

// ===================== PARTICLES =====================
let particles=[];
let particleAnim=null;
function startParticles(){
  const c=document.getElementById('particleCanvas');
  const ctx=c.getContext('2d');
  c.width=window.innerWidth;
  c.height=window.innerHeight;
  particles=[];
  const colors=['#00f0ff','#a855f7','#f59e0b','#22c55e','#ec4899','#3b82f6'];
  for(let i=0;i<120;i++){
    particles.push({
      x:c.width/2+Math.random()*200-100,
      y:c.height/2+Math.random()*100-50,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-0.5)*8-3,
      r:Math.random()*4+1,
      color:colors[Math.floor(Math.random()*colors.length)],
      life:1,
      decay:Math.random()*0.008+0.004,
      gravity:0.06
    });
  }
  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    let alive=false;
    for(const p of particles){
      if(p.life<=0)continue;
      alive=true;
      p.x+=p.vx;
      p.y+=p.vy;
      p.vy+=p.gravity;
      p.life-=p.decay;
      ctx.globalAlpha=p.life;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=p.color;
      ctx.fill();
    }
    ctx.globalAlpha=1;
    if(alive)particleAnim=requestAnimationFrame(draw);
  }
  draw();
}
function stopParticles(){
  if(particleAnim)cancelAnimationFrame(particleAnim);
  particles=[];
  const c=document.getElementById('particleCanvas');
  const ctx=c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);
}

// ===================== GAME FLOW =====================
function startGame(diff){
  currentDiff=diff;
  totalPairs=DIFFICULTY[diff].pairs;
  moves=0;matchedPairs=0;
  flippedCards=[];lockBoard=false;gameStarted=false;
  resetTimer();
  document.getElementById('moveCount').textContent='0';
  updateStars();

  buildGrid(diff);

  document.getElementById('menuScreen').style.display='none';
  document.getElementById('gameScreen').style.display='block';
}

function restartGame(){
  document.getElementById('winOverlay').classList.remove('show');
  stopParticles();
  startGame(currentDiff);
}

function backToMenu(){
  document.getElementById('winOverlay').classList.remove('show');
  stopParticles();
  stopTimer();
  document.getElementById('gameScreen').style.display='none';
  document.getElementById('menuScreen').style.display='flex';
  renderBestScores();
}

// ===================== INIT =====================
renderBestScores();
updateStars();
</script>
</body>
</html>
