<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SIMON - Echo Sequence</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --cyan: #00f0ff;
  --cyan-dim: rgba(0, 240, 255, 0.15);
  --cyan-glow: rgba(0, 240, 255, 0.6);
  --purple: #a855f7;
  --purple-dim: rgba(168, 85, 247, 0.15);
  --purple-glow: rgba(168, 85, 247, 0.6);
  --gold: #f59e0b;
  --gold-dim: rgba(245, 158, 11, 0.15);
  --gold-glow: rgba(245, 158, 11, 0.6);
  --green: #22c55e;
  --green-dim: rgba(34, 197, 94, 0.15);
  --green-glow: rgba(34, 197, 94, 0.6);
  --red: #ef4444;
  --bg: #05050f;
  --panel: rgba(10, 10, 30, 0.75);
  --glass: rgba(255, 255, 255, 0.03);
  --glass-border: rgba(255, 255, 255, 0.08);
  --text: #e2e8f0;
  --text-dim: rgba(255, 255, 255, 0.4);
}

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'Rajdhani', 'Noto Sans KR', sans-serif;
  color: var(--text);
  cursor: default;
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* ===== STAR CANVAS ===== */
#starCanvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 0;
  pointer-events: none;
}

/* ===== PARTICLE CANVAS ===== */
#particleCanvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 5;
  pointer-events: none;
}

/* ===== OVERLAY SYSTEM ===== */
.overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  transition: opacity 0.6s ease, visibility 0.6s ease;
  pointer-events: none;
}
.overlay.active { pointer-events: all; }
.overlay.hidden { opacity: 0; visibility: hidden; }

/* ===== MENU SCREEN ===== */
#menu {
  background: radial-gradient(ellipse at 50% 30%, rgba(0, 240, 255, 0.05) 0%, transparent 60%),
              radial-gradient(ellipse at 30% 70%, rgba(168, 85, 247, 0.04) 0%, transparent 50%);
}

.logo-container {
  text-align: center;
  margin-bottom: 40px;
  animation: logoFloat 6s ease-in-out infinite;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.game-title {
  font-family: 'Orbitron', monospace;
  font-size: clamp(56px, 12vw, 100px);
  font-weight: 900;
  letter-spacing: 16px;
  background: linear-gradient(135deg, var(--cyan) 0%, var(--purple) 50%, var(--gold) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 0 40px rgba(0, 240, 255, 0.3));
  line-height: 1.1;
}

.game-subtitle {
  font-family: 'Orbitron', monospace;
  font-size: clamp(14px, 3vw, 22px);
  font-weight: 400;
  color: var(--text-dim);
  letter-spacing: 12px;
  margin-top: 8px;
  text-transform: uppercase;
}

.menu-panel {
  background: var(--panel);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 40px 50px;
  text-align: center;
  min-width: 320px;
  max-width: 420px;
  width: 90%;
}

.menu-panel h2 {
  font-family: 'Orbitron', monospace;
  font-size: 16px;
  font-weight: 600;
  color: var(--cyan);
  letter-spacing: 4px;
  margin-bottom: 24px;
  text-transform: uppercase;
}

.high-score-display {
  font-family: 'Orbitron', monospace;
  font-size: 42px;
  font-weight: 800;
  color: var(--gold);
  filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.3));
  margin-bottom: 8px;
}

.high-score-label {
  font-family: 'Rajdhani', sans-serif;
  font-size: 14px;
  color: var(--text-dim);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 30px;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 14px 40px;
  border: 1px solid var(--cyan);
  border-radius: 12px;
  background: rgba(0, 240, 255, 0.08);
  color: var(--cyan);
  font-family: 'Orbitron', monospace;
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  margin: 6px;
}
.btn:hover {
  background: rgba(0, 240, 255, 0.18);
  box-shadow: 0 0 30px rgba(0, 240, 255, 0.2), inset 0 0 30px rgba(0, 240, 255, 0.05);
  transform: translateY(-2px);
}
.btn:active {
  transform: translateY(0);
}

.btn-secondary {
  border-color: var(--glass-border);
  background: var(--glass);
  color: var(--text-dim);
  font-size: 12px;
  padding: 10px 24px;
}
.btn-secondary:hover {
  border-color: rgba(255,255,255,0.2);
  color: var(--text);
  background: rgba(255,255,255,0.06);
  box-shadow: none;
}

/* ===== HUD ===== */
#hud {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 8;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.5s ease;
}
#hud.visible { opacity: 1; }

.hud-top {
  position: absolute;
  top: 20px; left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 30px;
  z-index: 9;
}

.hud-stat {
  text-align: center;
}

.hud-stat-label {
  font-family: 'Orbitron', monospace;
  font-size: 9px;
  font-weight: 500;
  color: var(--text-dim);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 2px;
}

.hud-stat-value {
  font-family: 'Orbitron', monospace;
  font-size: 28px;
  font-weight: 800;
  color: var(--cyan);
  filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.4));
}

.hud-stat-value.gold { color: var(--gold); filter: drop-shadow(0 0 10px rgba(245, 158, 11, 0.4)); }
.hud-stat-value.purple { color: var(--purple); filter: drop-shadow(0 0 10px rgba(168, 85, 247, 0.4)); }

.hud-divider {
  width: 1px;
  height: 36px;
  background: linear-gradient(to bottom, transparent, var(--glass-border), transparent);
}

.speed-bar-container {
  position: absolute;
  top: 85px;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  z-index: 9;
  text-align: center;
}

.speed-bar-label {
  font-family: 'Orbitron', monospace;
  font-size: 8px;
  color: var(--text-dim);
  letter-spacing: 3px;
  margin-bottom: 6px;
}

.speed-bar-track {
  width: 100%;
  height: 4px;
  background: rgba(255,255,255,0.06);
  border-radius: 2px;
  overflow: hidden;
}

.speed-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green), var(--gold), var(--red));
  border-radius: 2px;
  transition: width 0.4s ease;
  width: 20%;
}

/* Back link */
.back-link {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 20;
  text-decoration: none;
  color: var(--text-dim);
  font-family: 'Rajdhani', sans-serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 2px;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 8px;
  background: rgba(10,10,30,0.5);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}
.back-link:hover {
  color: var(--cyan);
  border-color: rgba(0,240,255,0.2);
  background: rgba(0,240,255,0.05);
}
.back-link svg {
  width: 14px; height: 14px;
  fill: none;
  stroke: currentColor;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* ===== GAME AREA ===== */
#gameArea {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 4;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.5s ease;
}
#gameArea.visible { opacity: 1; pointer-events: all; }

.simon-board {
  position: relative;
  width: min(70vw, 70vh, 480px);
  height: min(70vw, 70vh, 480px);
}

/* Center circle */
.center-circle {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 28%;
  height: 28%;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(15,15,35,0.95), rgba(5,5,15,0.98));
  border: 1px solid var(--glass-border);
  z-index: 6;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.3);
}

.center-round {
  font-family: 'Orbitron', monospace;
  font-size: clamp(22px, 5vw, 36px);
  font-weight: 900;
  color: var(--cyan);
  filter: drop-shadow(0 0 15px rgba(0, 240, 255, 0.5));
  line-height: 1;
  transition: color 0.3s ease, filter 0.3s ease;
}

.center-label {
  font-family: 'Orbitron', monospace;
  font-size: 7px;
  color: var(--text-dim);
  letter-spacing: 3px;
  margin-top: 2px;
}

/* ===== SIMON BUTTONS ===== */
.simon-btn {
  position: absolute;
  width: 44%;
  height: 44%;
  border: none;
  cursor: pointer;
  transition: filter 0.08s ease, transform 0.08s ease;
  -webkit-tap-highlight-color: transparent;
  outline: none;
  overflow: hidden;
}

.simon-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  opacity: 0;
  transition: opacity 0.1s ease;
}

.simon-btn.disabled {
  pointer-events: none;
}

/* Top - Cyan */
.simon-btn.top {
  top: 2%;
  left: 28%;
  border-radius: 50% 50% 8px 8px;
  background: linear-gradient(180deg, var(--cyan-dim) 0%, rgba(0,240,255,0.06) 100%);
  border: 1px solid rgba(0, 240, 255, 0.15);
  box-shadow: inset 0 0 30px rgba(0, 240, 255, 0.05), 0 0 15px rgba(0, 240, 255, 0.05);
}
.simon-btn.top::before {
  background: radial-gradient(ellipse at 50% 30%, rgba(0, 240, 255, 0.5), rgba(0, 240, 255, 0.15));
  border-radius: inherit;
}
.simon-btn.top.lit {
  background: linear-gradient(180deg, rgba(0, 240, 255, 0.5) 0%, rgba(0, 240, 255, 0.2) 100%);
  border-color: var(--cyan);
  box-shadow: inset 0 0 60px rgba(0, 240, 255, 0.3), 0 0 50px rgba(0, 240, 255, 0.4), 0 0 100px rgba(0, 240, 255, 0.2);
  filter: brightness(1.8);
}
.simon-btn.top.lit::before { opacity: 1; }

/* Right - Purple */
.simon-btn.right {
  top: 28%;
  right: 2%;
  border-radius: 8px 50% 50% 8px;
  background: linear-gradient(270deg, var(--purple-dim) 0%, rgba(168,85,247,0.06) 100%);
  border: 1px solid rgba(168, 85, 247, 0.15);
  box-shadow: inset 0 0 30px rgba(168, 85, 247, 0.05), 0 0 15px rgba(168, 85, 247, 0.05);
}
.simon-btn.right::before {
  background: radial-gradient(ellipse at 70% 50%, rgba(168, 85, 247, 0.5), rgba(168, 85, 247, 0.15));
  border-radius: inherit;
}
.simon-btn.right.lit {
  background: linear-gradient(270deg, rgba(168, 85, 247, 0.5) 0%, rgba(168, 85, 247, 0.2) 100%);
  border-color: var(--purple);
  box-shadow: inset 0 0 60px rgba(168, 85, 247, 0.3), 0 0 50px rgba(168, 85, 247, 0.4), 0 0 100px rgba(168, 85, 247, 0.2);
  filter: brightness(1.8);
}
.simon-btn.right.lit::before { opacity: 1; }

/* Bottom - Gold */
.simon-btn.bottom {
  bottom: 2%;
  left: 28%;
  border-radius: 8px 8px 50% 50%;
  background: linear-gradient(0deg, var(--gold-dim) 0%, rgba(245,158,11,0.06) 100%);
  border: 1px solid rgba(245, 158, 11, 0.15);
  box-shadow: inset 0 0 30px rgba(245, 158, 11, 0.05), 0 0 15px rgba(245, 158, 11, 0.05);
}
.simon-btn.bottom::before {
  background: radial-gradient(ellipse at 50% 70%, rgba(245, 158, 11, 0.5), rgba(245, 158, 11, 0.15));
  border-radius: inherit;
}
.simon-btn.bottom.lit {
  background: linear-gradient(0deg, rgba(245, 158, 11, 0.5) 0%, rgba(245, 158, 11, 0.2) 100%);
  border-color: var(--gold);
  box-shadow: inset 0 0 60px rgba(245, 158, 11, 0.3), 0 0 50px rgba(245, 158, 11, 0.4), 0 0 100px rgba(245, 158, 11, 0.2);
  filter: brightness(1.8);
}
.simon-btn.bottom.lit::before { opacity: 1; }

/* Left - Green */
.simon-btn.left {
  top: 28%;
  left: 2%;
  border-radius: 50% 8px 8px 50%;
  background: linear-gradient(90deg, var(--green-dim) 0%, rgba(34,197,94,0.06) 100%);
  border: 1px solid rgba(34, 197, 94, 0.15);
  box-shadow: inset 0 0 30px rgba(34, 197, 94, 0.05), 0 0 15px rgba(34, 197, 94, 0.05);
}
.simon-btn.left::before {
  background: radial-gradient(ellipse at 30% 50%, rgba(34, 197, 94, 0.5), rgba(34, 197, 94, 0.15));
  border-radius: inherit;
}
.simon-btn.left.lit {
  background: linear-gradient(90deg, rgba(34, 197, 94, 0.5) 0%, rgba(34, 197, 94, 0.2) 100%);
  border-color: var(--green);
  box-shadow: inset 0 0 60px rgba(34, 197, 94, 0.3), 0 0 50px rgba(34, 197, 94, 0.4), 0 0 100px rgba(34, 197, 94, 0.2);
  filter: brightness(1.8);
}
.simon-btn.left.lit::before { opacity: 1; }

/* Error flash */
.simon-btn.error {
  background: rgba(239, 68, 68, 0.35) !important;
  border-color: var(--red) !important;
  box-shadow: inset 0 0 60px rgba(239, 68, 68, 0.3), 0 0 60px rgba(239, 68, 68, 0.4) !important;
  filter: brightness(1.5) !important;
}

/* Hover */
.simon-btn:not(.disabled):not(.lit):hover {
  filter: brightness(1.2);
}
.simon-btn:not(.disabled):active {
  transform: scale(0.97);
}

/* Status indicator */
.status-text {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Orbitron', monospace;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-dim);
  letter-spacing: 4px;
  text-transform: uppercase;
  z-index: 9;
  opacity: 0;
  transition: opacity 0.3s ease, color 0.3s ease;
  white-space: nowrap;
}
.status-text.visible { opacity: 1; }
.status-text.watching { color: var(--gold); }
.status-text.your-turn { color: var(--green); }

/* ===== GAME OVER SCREEN ===== */
#gameOver {
  background: radial-gradient(ellipse at 50% 40%, rgba(239, 68, 68, 0.06) 0%, transparent 60%);
}

.gameover-panel {
  background: var(--panel);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  border: 1px solid rgba(239, 68, 68, 0.15);
  border-radius: 24px;
  padding: 50px;
  text-align: center;
  min-width: 320px;
  max-width: 440px;
  width: 90%;
  animation: panelSlideIn 0.6s ease;
}

@keyframes panelSlideIn {
  from { transform: scale(0.9) translateY(20px); opacity: 0; }
  to { transform: scale(1) translateY(0); opacity: 1; }
}

.gameover-title {
  font-family: 'Orbitron', monospace;
  font-size: 32px;
  font-weight: 900;
  color: var(--red);
  letter-spacing: 6px;
  margin-bottom: 30px;
  filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.3));
}

.gameover-score-section {
  margin-bottom: 30px;
}

.gameover-score-label {
  font-family: 'Orbitron', monospace;
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 4px;
  text-transform: uppercase;
  margin-bottom: 4px;
}

.gameover-score-value {
  font-family: 'Orbitron', monospace;
  font-size: 56px;
  font-weight: 900;
  color: var(--cyan);
  filter: drop-shadow(0 0 25px rgba(0, 240, 255, 0.4));
  line-height: 1;
}

.gameover-highscore {
  font-family: 'Orbitron', monospace;
  font-size: 14px;
  color: var(--gold);
  letter-spacing: 2px;
  margin-top: 10px;
  opacity: 0.8;
}

.new-record {
  display: inline-block;
  padding: 4px 16px;
  background: rgba(245, 158, 11, 0.15);
  border: 1px solid rgba(245, 158, 11, 0.3);
  border-radius: 20px;
  font-family: 'Orbitron', monospace;
  font-size: 11px;
  color: var(--gold);
  letter-spacing: 3px;
  margin-top: 12px;
  animation: recordPulse 2s ease-in-out infinite;
}

@keyframes recordPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.1); }
  50% { box-shadow: 0 0 25px rgba(245, 158, 11, 0.3); }
}

.gameover-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}

/* ===== SCREEN SHAKE ===== */
.screen-shake {
  animation: shake 0.5s ease;
}

@keyframes shake {
  0%, 100% { transform: translate(0); }
  10% { transform: translate(-8px, 4px); }
  20% { transform: translate(8px, -4px); }
  30% { transform: translate(-6px, 6px); }
  40% { transform: translate(6px, -2px); }
  50% { transform: translate(-4px, 2px); }
  60% { transform: translate(4px, -4px); }
  70% { transform: translate(-2px, 4px); }
  80% { transform: translate(2px, -2px); }
  90% { transform: translate(-2px, 0); }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 500px) {
  .simon-board {
    width: min(85vw, 85vh, 400px);
    height: min(85vw, 85vh, 400px);
  }
  .hud-top { gap: 16px; }
  .hud-stat-value { font-size: 22px; }
  .menu-panel { padding: 30px 24px; min-width: 0; }
  .game-title { letter-spacing: 8px; }
  .game-subtitle { letter-spacing: 6px; }
  .gameover-panel { padding: 35px 24px; }
  .gameover-score-value { font-size: 44px; }
  .back-link { top: 12px; left: 12px; font-size: 12px; padding: 6px 10px; }
}

@media (max-height: 650px) {
  .simon-board {
    width: min(55vh, 55vw, 380px);
    height: min(55vh, 55vw, 380px);
  }
  .logo-container { margin-bottom: 24px; }
  .game-title { font-size: clamp(36px, 8vw, 60px); }
}
</style>
</head>
<body>

<!-- Back Link -->
<a href="/games.html" class="back-link">
  <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
  ARCADE
</a>

<!-- Star Background Canvas -->
<canvas id="starCanvas"></canvas>

<!-- Particle Canvas -->
<canvas id="particleCanvas"></canvas>

<!-- HUD -->
<div id="hud">
  <div class="hud-top">
    <div class="hud-stat">
      <div class="hud-stat-label">ROUND</div>
      <div class="hud-stat-value" id="hudRound">1</div>
    </div>
    <div class="hud-divider"></div>
    <div class="hud-stat">
      <div class="hud-stat-label">HIGH</div>
      <div class="hud-stat-value gold" id="hudHigh">0</div>
    </div>
    <div class="hud-divider"></div>
    <div class="hud-stat">
      <div class="hud-stat-label">SCORE</div>
      <div class="hud-stat-value purple" id="hudScore">0</div>
    </div>
  </div>
  <div class="speed-bar-container">
    <div class="speed-bar-label">SPEED</div>
    <div class="speed-bar-track">
      <div class="speed-bar-fill" id="speedBar"></div>
    </div>
  </div>
</div>

<!-- Game Area -->
<div id="gameArea">
  <div class="simon-board" id="simonBoard">
    <button class="simon-btn top disabled" data-color="cyan" data-index="0"></button>
    <button class="simon-btn right disabled" data-color="purple" data-index="1"></button>
    <button class="simon-btn bottom disabled" data-color="gold" data-index="2"></button>
    <button class="simon-btn left disabled" data-color="green" data-index="3"></button>
    <div class="center-circle">
      <div class="center-round" id="centerRound">--</div>
      <div class="center-label">LEVEL</div>
    </div>
  </div>
</div>

<!-- Status Text -->
<div class="status-text" id="statusText">WATCH CAREFULLY</div>

<!-- Menu Overlay -->
<div class="overlay active" id="menu">
  <div class="logo-container">
    <div class="game-title">SIMON</div>
    <div class="game-subtitle">ECHO SEQUENCE</div>
  </div>
  <div class="menu-panel">
    <h2>MEMORY CHALLENGE</h2>
    <div class="high-score-display" id="menuHighScore">0</div>
    <div class="high-score-label">BEST LEVEL</div>
    <button class="btn" id="startBtn">START GAME</button>
    <br>
    <a href="/games.html" class="btn btn-secondary" style="margin-top: 12px;">BACK TO ARCADE</a>
  </div>
</div>

<!-- Game Over Overlay -->
<div class="overlay hidden" id="gameOver">
  <div class="gameover-panel">
    <div class="gameover-title">GAME OVER</div>
    <div class="gameover-score-section">
      <div class="gameover-score-label">LEVEL REACHED</div>
      <div class="gameover-score-value" id="finalScore">0</div>
      <div class="gameover-highscore" id="finalHighScore"></div>
      <div class="new-record" id="newRecord" style="display:none;">NEW RECORD</div>
    </div>
    <div class="gameover-buttons">
      <button class="btn" id="retryBtn">TRY AGAIN</button>
      <a href="/games.html" class="btn btn-secondary">BACK TO ARCADE</a>
    </div>
  </div>
</div>

<script>
// ===== STAR BACKGROUND =====
(function() {
  const canvas = document.getElementById('starCanvas');
  const ctx = canvas.getContext('2d');
  let stars = [];
  const STAR_COUNT = 200;

  function resize() {
    canvas.width = window.innerWidth * devicePixelRatio;
    canvas.height = window.innerHeight * devicePixelRatio;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    initStars();
  }

  function initStars() {
    stars = [];
    const w = window.innerWidth, h = window.innerHeight;
    for (let i = 0; i < STAR_COUNT; i++) {
      stars.push({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 1.5 + 0.3,
        a: Math.random(),
        speed: Math.random() * 0.0008 + 0.0003,
        phase: Math.random() * Math.PI * 2,
        drift: (Math.random() - 0.5) * 0.08
      });
    }
  }

  function drawStars(t) {
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    for (const s of stars) {
      const alpha = (Math.sin(t * s.speed * 1000 + s.phase) + 1) * 0.5 * 0.6 + 0.15;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(200, 220, 255, ${alpha * s.a})`;
      ctx.fill();

      s.y += s.drift * 0.2;
      s.x += s.drift * 0.1;
      if (s.y < -5) s.y = window.innerHeight + 5;
      if (s.y > window.innerHeight + 5) s.y = -5;
      if (s.x < -5) s.x = window.innerWidth + 5;
      if (s.x > window.innerWidth + 5) s.x = -5;
    }
  }

  let raf;
  function loop(t) {
    drawStars(t);
    raf = requestAnimationFrame(loop);
  }

  window.addEventListener('resize', resize);
  resize();
  loop(0);
})();

// ===== PARTICLE SYSTEM =====
const ParticleSystem = (function() {
  const canvas = document.getElementById('particleCanvas');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resize() {
    canvas.width = window.innerWidth * devicePixelRatio;
    canvas.height = window.innerHeight * devicePixelRatio;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
  }

  function burst(x, y, color, count) {
    for (let i = 0; i < count; i++) {
      const angle = (Math.PI * 2 / count) * i + (Math.random() - 0.5) * 0.8;
      const speed = Math.random() * 4 + 2;
      const life = Math.random() * 0.6 + 0.5;
      particles.push({
        x, y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        r: Math.random() * 3 + 1,
        color,
        life,
        maxLife: life,
        decay: 0.015 + Math.random() * 0.01
      });
    }
  }

  function update() {
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.97;
      p.vy *= 0.97;
      p.life -= p.decay;

      if (p.life <= 0) {
        particles.splice(i, 1);
        continue;
      }

      const alpha = p.life / p.maxLife;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r * alpha, 0, Math.PI * 2);
      ctx.fillStyle = p.color.replace('1)', `${alpha})`);
      ctx.fill();

      // Glow
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r * alpha * 3, 0, Math.PI * 2);
      ctx.fillStyle = p.color.replace('1)', `${alpha * 0.2})`);
      ctx.fill();
    }
    requestAnimationFrame(update);
  }

  window.addEventListener('resize', resize);
  resize();
  update();

  return { burst };
})();

// ===== AUDIO SYSTEM =====
const AudioSystem = (function() {
  let audioCtx = null;

  function getCtx() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') audioCtx.resume();
    return audioCtx;
  }

  // Frequencies for each button - pleasant musical tones (C major pentatonic)
  const TONES = {
    0: 329.63,  // E4 - cyan (top)
    1: 440.00,  // A4 - purple (right)
    2: 261.63,  // C4 - gold (bottom)
    3: 392.00   // G4 - green (left)
  };

  function playTone(index, duration) {
    const ctx = getCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    const osc2 = ctx.createOscillator();
    const gain2 = ctx.createGain();

    // Main tone - sine wave
    osc.type = 'sine';
    osc.frequency.value = TONES[index];
    gain.gain.setValueAtTime(0, ctx.currentTime);
    gain.gain.linearRampToValueAtTime(0.25, ctx.currentTime + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);

    // Harmonic overtone - triangle
    osc2.type = 'triangle';
    osc2.frequency.value = TONES[index] * 2;
    gain2.gain.setValueAtTime(0, ctx.currentTime);
    gain2.gain.linearRampToValueAtTime(0.06, ctx.currentTime + 0.01);
    gain2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration * 0.6);

    osc.connect(gain);
    gain.connect(ctx.destination);
    osc2.connect(gain2);
    gain2.connect(ctx.destination);

    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + duration);
    osc2.start(ctx.currentTime);
    osc2.stop(ctx.currentTime + duration * 0.6);
  }

  function playError() {
    const ctx = getCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(150, ctx.currentTime);
    osc.frequency.linearRampToValueAtTime(80, ctx.currentTime + 0.5);
    gain.gain.setValueAtTime(0.2, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.5);
  }

  function playSuccess() {
    const ctx = getCtx();
    [523.25, 659.25, 783.99].forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.08);
      gain.gain.linearRampToValueAtTime(0.15, ctx.currentTime + i * 0.08 + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.08 + 0.3);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start(ctx.currentTime + i * 0.08);
      osc.stop(ctx.currentTime + i * 0.08 + 0.3);
    });
  }

  return { playTone, playError, playSuccess };
})();

// ===== GAME LOGIC =====
const Game = (function() {
  const buttons = document.querySelectorAll('.simon-btn');
  const hudRound = document.getElementById('hudRound');
  const hudHigh = document.getElementById('hudHigh');
  const hudScore = document.getElementById('hudScore');
  const speedBar = document.getElementById('speedBar');
  const centerRound = document.getElementById('centerRound');
  const statusText = document.getElementById('statusText');
  const menuHighScore = document.getElementById('menuHighScore');
  const finalScore = document.getElementById('finalScore');
  const finalHighScore = document.getElementById('finalHighScore');
  const newRecord = document.getElementById('newRecord');
  const hud = document.getElementById('hud');
  const gameArea = document.getElementById('gameArea');
  const menuOverlay = document.getElementById('menu');
  const gameOverOverlay = document.getElementById('gameOver');

  const COLORS_RGBA = {
    0: 'rgba(0, 240, 255, 1)',
    1: 'rgba(168, 85, 247, 1)',
    2: 'rgba(245, 158, 11, 1)',
    3: 'rgba(34, 197, 94, 1)'
  };

  let sequence = [];
  let playerIndex = 0;
  let round = 0;
  let score = 0;
  let highScore = parseInt(localStorage.getItem('simon_highscore')) || 0;
  let isPlaying = false;
  let isShowingSequence = false;
  let baseDelay = 600;   // ms between sequence lights
  let litDuration = 400; // ms a button stays lit

  // Speed settings: every 5 rounds the game speeds up
  function getSpeed() {
    const tier = Math.floor(round / 5);
    const factor = Math.max(0.35, 1 - tier * 0.12);
    return {
      delay: baseDelay * factor,
      lit: litDuration * factor,
      speedPercent: Math.min(100, 20 + tier * 16)
    };
  }

  function init() {
    menuHighScore.textContent = highScore;
    hudHigh.textContent = highScore;
  }

  function startGame() {
    sequence = [];
    playerIndex = 0;
    round = 0;
    score = 0;
    isPlaying = true;

    menuOverlay.classList.remove('active');
    menuOverlay.classList.add('hidden');
    gameOverOverlay.classList.remove('active');
    gameOverOverlay.classList.add('hidden');
    hud.classList.add('visible');
    gameArea.classList.add('visible');

    updateHUD();
    nextRound();
  }

  function nextRound() {
    round++;
    playerIndex = 0;

    // Add a random button to sequence
    sequence.push(Math.floor(Math.random() * 4));

    updateHUD();

    // Brief delay before showing sequence
    setStatus('WATCH CAREFULLY', 'watching');
    disableButtons();

    setTimeout(() => {
      showSequence();
    }, 600);
  }

  function showSequence() {
    isShowingSequence = true;
    disableButtons();

    const speed = getSpeed();
    let i = 0;

    function lightNext() {
      if (i >= sequence.length) {
        isShowingSequence = false;
        enableButtons();
        setStatus('YOUR TURN', 'your-turn');
        return;
      }

      const idx = sequence[i];
      lightButton(idx, speed.lit);
      AudioSystem.playTone(idx, speed.lit / 1000 + 0.1);
      i++;
      setTimeout(lightNext, speed.delay);
    }

    lightNext();
  }

  function lightButton(index, duration) {
    const btn = buttons[index];
    btn.classList.add('lit');

    // Particle burst at button center
    const rect = btn.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    ParticleSystem.burst(cx, cy, COLORS_RGBA[index], 12);

    setTimeout(() => {
      btn.classList.remove('lit');
    }, duration);
  }

  function handlePlayerInput(index) {
    if (!isPlaying || isShowingSequence) return;

    const speed = getSpeed();

    // Light up the pressed button
    lightButton(index, 200);
    AudioSystem.playTone(index, 0.25);

    if (sequence[playerIndex] === index) {
      // Correct
      playerIndex++;
      score += round;
      updateHUD();

      if (playerIndex >= sequence.length) {
        // Completed the round
        disableButtons();
        setStatus('CORRECT!', 'your-turn');
        AudioSystem.playSuccess();

        // Extra particle celebration
        const board = document.getElementById('simonBoard');
        const rect = board.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        for (let c = 0; c < 4; c++) {
          setTimeout(() => {
            ParticleSystem.burst(cx + (Math.random()-0.5)*100, cy + (Math.random()-0.5)*100, COLORS_RGBA[c], 8);
          }, c * 60);
        }

        setTimeout(() => {
          nextRound();
        }, 1000);
      }
    } else {
      // Wrong!
      gameOverSequence();
    }
  }

  function gameOverSequence() {
    isPlaying = false;
    disableButtons();
    setStatus('', '');

    AudioSystem.playError();

    // Flash all buttons red
    buttons.forEach(b => b.classList.add('error'));

    // Screen shake
    document.body.classList.add('screen-shake');
    setTimeout(() => document.body.classList.remove('screen-shake'), 500);

    // Red particle burst from center
    const board = document.getElementById('simonBoard');
    const rect = board.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    ParticleSystem.burst(cx, cy, 'rgba(239, 68, 68, 1)', 40);

    setTimeout(() => {
      buttons.forEach(b => b.classList.remove('error'));
    }, 600);

    // Flash red a second time
    setTimeout(() => {
      buttons.forEach(b => b.classList.add('error'));
      setTimeout(() => buttons.forEach(b => b.classList.remove('error')), 400);
    }, 700);

    // Check high score
    const isNewRecord = round > highScore;
    if (isNewRecord) {
      highScore = round;
      localStorage.setItem('simon_highscore', highScore);
    }

    // Show game over
    setTimeout(() => {
      showGameOver(isNewRecord);
    }, 1500);
  }

  function showGameOver(isNewRecord) {
    hud.classList.remove('visible');
    gameArea.classList.remove('visible');

    finalScore.textContent = round;
    finalHighScore.textContent = `BEST: ${highScore}`;
    newRecord.style.display = isNewRecord ? 'inline-block' : 'none';

    gameOverOverlay.classList.add('active');
    gameOverOverlay.classList.remove('hidden');
  }

  function updateHUD() {
    hudRound.textContent = round;
    hudHigh.textContent = highScore;
    hudScore.textContent = score;
    centerRound.textContent = round || '--';

    const speed = getSpeed();
    speedBar.style.width = speed.speedPercent + '%';
  }

  function setStatus(text, cls) {
    statusText.textContent = text;
    statusText.className = 'status-text';
    if (text) {
      statusText.classList.add('visible');
      if (cls) statusText.classList.add(cls);
    }
  }

  function enableButtons() {
    buttons.forEach(b => b.classList.remove('disabled'));
  }

  function disableButtons() {
    buttons.forEach(b => b.classList.add('disabled'));
  }

  // Event listeners
  buttons.forEach(btn => {
    const handler = (e) => {
      e.preventDefault();
      if (btn.classList.contains('disabled')) return;
      handlePlayerInput(parseInt(btn.dataset.index));
    };
    btn.addEventListener('click', handler);
    btn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (btn.classList.contains('disabled')) return;
      handlePlayerInput(parseInt(btn.dataset.index));
    }, { passive: false });
  });

  document.getElementById('startBtn').addEventListener('click', startGame);
  document.getElementById('retryBtn').addEventListener('click', startGame);

  // Keyboard support: arrow keys
  document.addEventListener('keydown', (e) => {
    if (!isPlaying || isShowingSequence) return;
    const map = { ArrowUp: 0, ArrowRight: 1, ArrowDown: 2, ArrowLeft: 3 };
    if (map[e.key] !== undefined) {
      e.preventDefault();
      handlePlayerInput(map[e.key]);
    }
  });

  return { init };
})();

// Initialize
Game.init();
</script>
</body>
</html>
