<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 퍼즐</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0a;color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;user-select:none}
.top-bar{width:100%;max-width:440px;display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.back{color:rgba(255,255,255,0.4);text-decoration:none;font-size:0.85rem;padding:8px 14px;border-radius:10px;transition:all 0.2s}
.back:hover{background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.7)}
h1{font-size:1.8rem;font-weight:800}
.btn{background:rgba(255,255,255,0.06);border:none;color:rgba(255,255,255,0.7);padding:8px 16px;border-radius:10px;cursor:pointer;font-size:0.8rem;transition:all 0.2s}
.btn:hover{background:rgba(255,255,255,0.1);color:#fff}
.scores{display:flex;gap:12px;margin-bottom:20px;width:100%;max-width:440px}
.score-box{flex:1;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:14px;text-align:center}
.score-label{font-size:0.65rem;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.score-val{font-size:1.6rem;font-weight:700;color:#eab308}
.score-val.best{color:#facc15}
.board{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:14px;border-radius:18px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02)}
.tile{width:90px;height:90px;display:flex;align-items:center;justify-content:center;border-radius:12px;font-weight:700;transition:all 0.12s ease;background:rgba(255,255,255,0.03)}
.tile[data-v="2"]{background:rgba(120,53,15,0.4);color:#fde68a}
.tile[data-v="4"]{background:rgba(120,53,15,0.55);color:#fde68a}
.tile[data-v="8"]{background:rgba(194,65,12,0.6);color:#fed7aa}
.tile[data-v="16"]{background:rgba(234,88,12,0.65);color:#fff7ed}
.tile[data-v="32"]{background:rgba(220,38,38,0.65);color:#fef2f2}
.tile[data-v="64"]{background:rgba(239,68,68,0.75);color:#fff}
.tile[data-v="128"]{background:rgba(234,179,8,0.65);color:#fff;font-size:1.5rem}
.tile[data-v="256"]{background:rgba(250,204,21,0.65);color:#422006;font-size:1.5rem}
.tile[data-v="512"]{background:rgba(253,224,71,0.7);color:#422006;font-size:1.5rem}
.tile[data-v="1024"]{background:rgba(254,240,138,0.75);color:#422006;font-size:1.2rem}
.tile[data-v="2048"]{background:rgba(254,249,195,0.85);color:#422006;font-size:1.2rem;box-shadow:0 0 30px rgba(234,179,8,0.4)}
.tile.big{font-size:1.1rem}
.tile.small{font-size:1.5rem}
.tile.normal{font-size:1.8rem}
.overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);border-radius:18px;z-index:10}
.overlay h2{font-size:2rem;margin-bottom:8px}
.overlay p{color:rgba(255,255,255,0.5);margin-bottom:20px;font-size:1.1rem}
.overlay .btn{padding:12px 28px;font-size:0.95rem;background:rgba(234,179,8,0.8);color:#000;font-weight:600;border-radius:12px}
.overlay .btn:hover{background:#eab308}
.overlay .btn-row{display:flex;gap:12px}
.overlay .btn-secondary{background:rgba(255,255,255,0.1);color:#fff}
.overlay .btn-secondary:hover{background:rgba(255,255,255,0.2)}
.board-wrap{position:relative;margin-bottom:20px}
.info{max-width:440px;width:100%;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:16px}
.info h3{font-size:0.8rem;color:rgba(255,255,255,0.5);margin-bottom:8px}
.info p{font-size:0.75rem;color:rgba(255,255,255,0.3);line-height:1.8}
@media(max-width:500px){
  .tile{width:72px;height:72px;font-size:1.2rem}
  .tile.big{font-size:0.9rem}
  .tile.small{font-size:1.2rem}
  .tile.normal{font-size:1.4rem}
  .board{gap:8px;padding:10px}
}
</style>
</head>
<body>

<div class="top-bar">
  <a href="/games.html" class="back">← 게임 허브</a>
  <h1>2048</h1>
  <button class="btn" onclick="initGame()">새 게임</button>
</div>

<div class="scores">
  <div class="score-box">
    <div class="score-label">점수</div>
    <div class="score-val" id="score">0</div>
  </div>
  <div class="score-box">
    <div class="score-label">최고 점수</div>
    <div class="score-val best" id="best">0</div>
  </div>
</div>

<div class="board-wrap">
  <div class="board" id="board"></div>
  <div class="overlay" id="overGameOver" style="display:none">
    <h2>게임 오버!</h2>
    <p>점수: <span id="finalScore">0</span></p>
    <button class="btn" onclick="initGame()">다시 하기</button>
  </div>
  <div class="overlay" id="overWin" style="display:none">
    <h2 style="color:#facc15">축하합니다!</h2>
    <p>2048을 달성했습니다!</p>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="keepPlaying()">계속 플레이</button>
      <button class="btn" onclick="initGame()">새 게임</button>
    </div>
  </div>
</div>

<div class="info">
  <h3>조작법</h3>
  <p>⬆⬇⬅➡ 방향키 또는 WASD로 이동 | 모바일: 스와이프 | 같은 숫자를 합쳐 2048을 만드세요</p>
</div>

<script>
let board, score, bestScore, gameOver, won, playing;

function init() {
  bestScore = parseInt(localStorage.getItem('best2048') || '0');
  document.getElementById('best').textContent = bestScore.toLocaleString();
  initGame();
}

function initGame() {
  board = Array.from({length:4}, () => Array(4).fill(0));
  score = 0; gameOver = false; won = false; playing = false;
  addTile(); addTile();
  document.getElementById('overGameOver').style.display = 'none';
  document.getElementById('overWin').style.display = 'none';
  render();
}

function keepPlaying() {
  playing = true;
  document.getElementById('overWin').style.display = 'none';
}

function addTile() {
  const empty = [];
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) if(!board[r][c]) empty.push([r,c]);
  if(!empty.length) return;
  const [r,c] = empty[Math.floor(Math.random()*empty.length)];
  board[r][c] = Math.random() < 0.9 ? 2 : 4;
}

function rotateBoard(b) {
  const n = b.length, rot = Array.from({length:n}, () => Array(n).fill(0));
  for(let r=0;r<n;r++) for(let c=0;c<n;c++) rot[c][n-1-r] = b[r][c];
  return rot;
}

function slideLeft(b) {
  let sc = 0, moved = false;
  const nb = Array.from({length:4}, () => Array(4).fill(0));
  for(let r=0;r<4;r++) {
    const row = b[r].filter(v => v);
    const merged = [];
    let i = 0;
    while(i < row.length) {
      if(i+1 < row.length && row[i] === row[i+1]) { merged.push(row[i]*2); sc += row[i]*2; i+=2; }
      else { merged.push(row[i]); i++; }
    }
    for(let c=0;c<4;c++) { nb[r][c] = merged[c]||0; if(nb[r][c] !== b[r][c]) moved = true; }
  }
  return {board:nb, score:sc, moved};
}

function move(dir) {
  if(gameOver) return;
  if(won && !playing) return;
  const rots = {left:0,down:1,right:2,up:3};
  let b = board;
  for(let i=0;i<rots[dir];i++) b = rotateBoard(b);
  const res = slideLeft(b);
  let fb = res.board;
  for(let i=0;i<(4-rots[dir])%4;i++) fb = rotateBoard(fb);
  if(!res.moved) return;
  board = fb; addTile();
  score += res.score;
  if(score > bestScore) { bestScore = score; localStorage.setItem('best2048', bestScore.toString()); }
  if(!playing && board.some(r => r.some(v => v >= 2048))) { won = true; }
  if(!canMove()) gameOver = true;
  render();
}

function canMove() {
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) {
    if(!board[r][c]) return true;
    if(c+1<4 && board[r][c]===board[r][c+1]) return true;
    if(r+1<4 && board[r][c]===board[r+1][c]) return true;
  }
  return false;
}

function render() {
  document.getElementById('score').textContent = score.toLocaleString();
  document.getElementById('best').textContent = bestScore.toLocaleString();
  const el = document.getElementById('board');
  el.innerHTML = '';
  for(let r=0;r<4;r++) for(let c=0;c<4;c++) {
    const v = board[r][c];
    const tile = document.createElement('div');
    tile.className = 'tile' + (v >= 1024 ? ' big' : v >= 128 ? ' small' : ' normal');
    if(v) { tile.textContent = v; tile.setAttribute('data-v', v > 2048 ? '2048' : v); }
    el.appendChild(tile);
  }
  if(gameOver) {
    document.getElementById('finalScore').textContent = score.toLocaleString();
    document.getElementById('overGameOver').style.display = 'flex';
  }
  if(won && !playing) document.getElementById('overWin').style.display = 'flex';
}

// Keyboard
document.addEventListener('keydown', e => {
  const map = {ArrowLeft:'left',ArrowRight:'right',ArrowUp:'up',ArrowDown:'down',a:'left',d:'right',w:'up',s:'down'};
  if(map[e.key]) { e.preventDefault(); move(map[e.key]); }
});

// Touch
let tx, ty;
document.addEventListener('touchstart', e => { tx = e.touches[0].clientX; ty = e.touches[0].clientY; });
document.addEventListener('touchend', e => {
  const dx = e.changedTouches[0].clientX - tx;
  const dy = e.changedTouches[0].clientY - ty;
  if(Math.max(Math.abs(dx),Math.abs(dy)) < 30) return;
  if(Math.abs(dx) > Math.abs(dy)) move(dx > 0 ? 'right' : 'left');
  else move(dy > 0 ? 'down' : 'up');
});

init();
</script>
</body>
</html>
