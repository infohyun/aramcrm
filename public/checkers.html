<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHECKERS - Neon Tactics</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

*{margin:0;padding:0;box-sizing:border-box}

:root{
  --cyan:#00f0ff;
  --purple:#a855f7;
  --gold:#f59e0b;
  --red:#ef4444;
  --green:#22c55e;
  --blue:#3b82f6;
  --pink:#ec4899;
  --bg:#05050f;
  --glass:rgba(255,255,255,0.02);
  --glass-border:rgba(255,255,255,0.06);
  --glass-hover:rgba(255,255,255,0.05);
  --text:#e2e8f0;
  --text-dim:rgba(255,255,255,0.35);
}

html{scroll-behavior:smooth}

body{
  background:var(--bg);
  color:var(--text);
  font-family:'Rajdhani','Noto Sans KR',sans-serif;
  min-height:100vh;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  display:flex;
  flex-direction:column;
  align-items:center;
  user-select:none;
  -webkit-user-select:none;
}

/* ===== STARFIELD BACKGROUND ===== */
.starfield{
  position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;overflow:hidden;
}
.star{
  position:absolute;
  width:2px;height:2px;
  background:#fff;
  border-radius:50%;
  animation:twinkle var(--dur) ease-in-out infinite;
  opacity:0;
}
@keyframes twinkle{
  0%,100%{opacity:0;transform:scale(0.5)}
  50%{opacity:var(--max-o);transform:scale(1)}
}
.nebula{
  position:absolute;
  border-radius:50%;
  filter:blur(80px);
  opacity:0.06;
  animation:nebulaDrift 30s ease-in-out infinite alternate;
}
@keyframes nebulaDrift{
  0%{transform:translate(0,0) scale(1)}
  100%{transform:translate(30px,-20px) scale(1.1)}
}

/* ===== SCANLINE OVERLAY ===== */
.scanlines{
  position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;
  background:repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,240,255,0.008) 2px,
    rgba(0,240,255,0.008) 4px
  );
}

/* ===== HEADER ===== */
.header{
  position:relative;z-index:10;
  width:100%;
  padding:16px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:rgba(5,5,15,0.8);
  border-bottom:1px solid var(--glass-border);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
}
.back-link{
  display:flex;align-items:center;gap:8px;
  color:var(--text-dim);
  text-decoration:none;
  font-family:'Rajdhani',sans-serif;
  font-size:15px;font-weight:500;
  letter-spacing:1px;
  text-transform:uppercase;
  transition:all 0.3s;
}
.back-link:hover{color:var(--cyan);text-shadow:0 0 10px rgba(0,240,255,0.3)}
.back-link svg{width:18px;height:18px;transition:transform 0.3s}
.back-link:hover svg{transform:translateX(-3px)}
.header-brand{
  font-family:'Orbitron',monospace;
  font-size:13px;font-weight:600;
  letter-spacing:3px;
  color:var(--text-dim);
}
.header-brand span{color:var(--cyan)}

/* ===== TITLE ===== */
.title-section{
  position:relative;z-index:10;
  text-align:center;
  margin-top:24px;
  margin-bottom:8px;
}
.title-main{
  font-family:'Orbitron',monospace;
  font-size:clamp(32px,5.5vw,52px);
  font-weight:900;
  letter-spacing:12px;
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  text-shadow:none;
  filter:drop-shadow(0 0 30px rgba(0,240,255,0.25));
  line-height:1.1;
}
.title-sub{
  font-family:'Orbitron',monospace;
  font-size:clamp(10px,1.8vw,13px);
  font-weight:400;
  letter-spacing:8px;
  color:var(--text-dim);
  margin-top:4px;
}

/* ===== GAME AREA ===== */
.game-wrapper{
  position:relative;z-index:10;
  display:flex;
  gap:20px;
  margin:12px 16px 24px;
  align-items:flex-start;
  flex-wrap:wrap;
  justify-content:center;
  width:100%;
  max-width:1100px;
}

/* ===== SIDE PANELS ===== */
.side-panel{
  width:200px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.panel-box{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:16px;
  padding:16px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
}
.panel-title{
  font-family:'Orbitron',monospace;
  font-size:11px;
  font-weight:600;
  letter-spacing:2px;
  color:var(--text-dim);
  text-transform:uppercase;
  margin-bottom:10px;
}

/* Turn indicator */
.turn-indicator{
  display:flex;align-items:center;gap:10px;
  padding:10px 0;
}
.turn-disc{
  width:28px;height:28px;
  border-radius:50%;
  transition:all 0.4s;
}
.turn-disc.cyan{
  background:radial-gradient(circle at 35% 35%,#80ffff,var(--cyan),#0088aa);
  box-shadow:0 0 12px var(--cyan),0 0 24px rgba(0,240,255,0.3);
}
.turn-disc.purple{
  background:radial-gradient(circle at 35% 35%,#d8b4fe,var(--purple),#6b21a8);
  box-shadow:0 0 12px var(--purple),0 0 24px rgba(168,85,247,0.3);
}
.turn-text{
  font-family:'Rajdhani',sans-serif;
  font-size:16px;font-weight:600;
  letter-spacing:1px;
}
.turn-text.cyan{color:var(--cyan)}
.turn-text.purple{color:var(--purple)}

/* Captured display */
.captured-row{
  display:flex;flex-wrap:wrap;gap:4px;
  margin-top:4px;
  min-height:28px;
}
.captured-piece{
  width:20px;height:20px;
  border-radius:50%;
  opacity:0.5;
  transition:all 0.3s;
}
.captured-piece.cyan-cap{
  background:radial-gradient(circle,#80ffff,var(--cyan));
  box-shadow:0 0 6px rgba(0,240,255,0.3);
}
.captured-piece.purple-cap{
  background:radial-gradient(circle,#d8b4fe,var(--purple));
  box-shadow:0 0 6px rgba(168,85,247,0.3);
}

/* Score */
.score-display{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:4px;
}
.score-val{
  font-family:'Orbitron',monospace;
  font-size:28px;font-weight:800;
}
.score-val.cyan-s{color:var(--cyan);text-shadow:0 0 16px rgba(0,240,255,0.4)}
.score-val.purple-s{color:var(--purple);text-shadow:0 0 16px rgba(168,85,247,0.4)}
.score-vs{
  font-family:'Orbitron',monospace;
  font-size:12px;color:var(--text-dim);
  letter-spacing:2px;
}

/* Mode buttons */
.mode-btn{
  width:100%;
  padding:10px 12px;
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:10px;
  color:var(--text-dim);
  font-family:'Rajdhani',sans-serif;
  font-size:14px;font-weight:600;
  letter-spacing:1px;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
  backdrop-filter:blur(10px);
}
.mode-btn:hover{
  background:var(--glass-hover);
  color:var(--text);
  border-color:rgba(255,255,255,0.12);
}
.mode-btn.active{
  border-color:var(--cyan);
  color:var(--cyan);
  box-shadow:0 0 12px rgba(0,240,255,0.15),inset 0 0 12px rgba(0,240,255,0.05);
}
.new-game-btn{
  width:100%;
  padding:12px;
  background:linear-gradient(135deg,rgba(0,240,255,0.12),rgba(168,85,247,0.12));
  border:1px solid rgba(0,240,255,0.25);
  border-radius:10px;
  color:var(--cyan);
  font-family:'Orbitron',monospace;
  font-size:12px;font-weight:600;
  letter-spacing:2px;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
}
.new-game-btn:hover{
  background:linear-gradient(135deg,rgba(0,240,255,0.2),rgba(168,85,247,0.2));
  box-shadow:0 0 20px rgba(0,240,255,0.2);
  transform:translateY(-1px);
}

/* Difficulty */
.diff-btns{display:flex;gap:6px;margin-top:4px;}
.diff-btn{
  flex:1;
  padding:6px 4px;
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:8px;
  color:var(--text-dim);
  font-family:'Rajdhani',sans-serif;
  font-size:11px;font-weight:600;
  letter-spacing:0.5px;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
}
.diff-btn:hover{color:var(--text);border-color:rgba(255,255,255,0.12)}
.diff-btn.active{
  color:var(--gold);
  border-color:var(--gold);
  box-shadow:0 0 8px rgba(245,158,11,0.15);
}

/* ===== BOARD ===== */
.board-container{
  position:relative;
  flex-shrink:0;
}
.board-frame{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:12px;
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  box-shadow:
    0 0 60px rgba(0,240,255,0.04),
    0 0 120px rgba(168,85,247,0.03),
    inset 0 1px 0 rgba(255,255,255,0.04);
}
.board{
  display:grid;
  grid-template-columns:repeat(8,1fr);
  grid-template-rows:repeat(8,1fr);
  gap:2px;
  border-radius:12px;
  overflow:hidden;
  width:clamp(280px,55vmin,520px);
  height:clamp(280px,55vmin,520px);
}
.cell{
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:default;
  transition:background 0.2s;
}
.cell.light{
  background:rgba(255,255,255,0.04);
}
.cell.dark{
  background:rgba(15,10,30,0.6);
  border:1px solid rgba(255,255,255,0.02);
}
.cell.dark.playable{
  cursor:pointer;
}
.cell.dark.valid-move{
  cursor:pointer;
}
.cell.dark.valid-move::after{
  content:'';
  position:absolute;
  width:28%;height:28%;
  border-radius:50%;
  background:radial-gradient(circle,rgba(0,240,255,0.6),rgba(0,240,255,0.15));
  box-shadow:0 0 10px rgba(0,240,255,0.4),0 0 20px rgba(0,240,255,0.15);
  animation:pulseHint 1.5s ease-in-out infinite;
  z-index:2;
}
.cell.dark.valid-capture::after{
  width:50%;height:50%;
  background:radial-gradient(circle,rgba(245,158,11,0.7),rgba(245,158,11,0.15));
  box-shadow:0 0 14px rgba(245,158,11,0.5),0 0 28px rgba(245,158,11,0.2);
}
@keyframes pulseHint{
  0%,100%{transform:scale(0.85);opacity:0.6}
  50%{transform:scale(1.15);opacity:1}
}

/* Row & Col labels */
.board-labels-row{
  display:flex;
  justify-content:space-around;
  padding:4px 0 0;
}
.board-labels-col{
  display:flex;
  flex-direction:column;
  justify-content:space-around;
  padding:0 4px 0 0;
}
.board-label{
  font-family:'Orbitron',monospace;
  font-size:9px;
  color:var(--text-dim);
  text-align:center;
  letter-spacing:1px;
  width:auto;
}
.board-with-labels{
  display:flex;
  align-items:stretch;
}
.board-bottom-labels{
  display:flex;
  padding:4px 0 0 24px;
}
.board-bottom-labels .board-label{
  flex:1;text-align:center;
}

/* ===== PIECES ===== */
.piece{
  position:absolute;
  width:78%;height:78%;
  border-radius:50%;
  z-index:5;
  cursor:pointer;
  transition:transform 0.15s,box-shadow 0.15s;
}
.piece:hover{
  transform:scale(1.08);
}
.piece.player{
  background:radial-gradient(circle at 35% 35%,#b0ffff,var(--cyan),#006680);
  box-shadow:
    0 0 12px var(--cyan),
    0 0 28px rgba(0,240,255,0.35),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}
.piece.ai{
  background:radial-gradient(circle at 35% 35%,#e0c0ff,var(--purple),#4c1d95);
  box-shadow:
    0 0 12px var(--purple),
    0 0 28px rgba(168,85,247,0.35),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}
.piece.selected{
  transform:scale(1.12);
  animation:selectedPulse 1s ease-in-out infinite;
}
.piece.player.selected{
  box-shadow:
    0 0 18px var(--cyan),
    0 0 40px rgba(0,240,255,0.5),
    0 0 60px rgba(0,240,255,0.2),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}
.piece.ai.selected{
  box-shadow:
    0 0 18px var(--purple),
    0 0 40px rgba(168,85,247,0.5),
    0 0 60px rgba(168,85,247,0.2),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}
@keyframes selectedPulse{
  0%,100%{filter:brightness(1)}
  50%{filter:brightness(1.25)}
}

/* King crown */
.piece.king::after{
  content:'â™›';
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:clamp(14px,2.8vmin,24px);
  color:var(--gold);
  text-shadow:0 0 8px var(--gold),0 0 16px rgba(245,158,11,0.4);
  filter:drop-shadow(0 0 4px var(--gold));
  z-index:6;
}
.piece.king.player{
  box-shadow:
    0 0 14px var(--cyan),
    0 0 30px rgba(0,240,255,0.4),
    0 0 8px var(--gold),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}
.piece.king.ai{
  box-shadow:
    0 0 14px var(--purple),
    0 0 30px rgba(168,85,247,0.4),
    0 0 8px var(--gold),
    inset 0 -3px 6px rgba(0,0,0,0.3),
    inset 0 2px 4px rgba(255,255,255,0.3);
}

/* Piece ring for king */
.piece.king::before{
  content:'';
  position:absolute;
  top:-4px;left:-4px;right:-4px;bottom:-4px;
  border-radius:50%;
  border:2px solid var(--gold);
  opacity:0.5;
  animation:kingRing 2s ease-in-out infinite;
}
@keyframes kingRing{
  0%,100%{opacity:0.3;transform:scale(1)}
  50%{opacity:0.7;transform:scale(1.05)}
}

/* Moving piece animation */
.piece.moving{
  transition:left 0.3s cubic-bezier(0.25,0.46,0.45,0.94),
             top 0.3s cubic-bezier(0.25,0.46,0.45,0.94);
  z-index:20;
}

/* ===== PARTICLES ===== */
.particle{
  position:absolute;
  border-radius:50%;
  pointer-events:none;
  z-index:30;
}

/* ===== OVERLAY SCREENS ===== */
.overlay{
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  z-index:100;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(5,5,15,0.85);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  opacity:0;
  pointer-events:none;
  transition:opacity 0.4s;
}
.overlay.active{
  opacity:1;
  pointer-events:all;
}
.overlay-box{
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:24px;
  padding:40px 48px;
  text-align:center;
  backdrop-filter:blur(30px);
  -webkit-backdrop-filter:blur(30px);
  box-shadow:0 0 80px rgba(0,240,255,0.06);
  transform:scale(0.9);
  transition:transform 0.4s;
  max-width:90vw;
}
.overlay.active .overlay-box{
  transform:scale(1);
}
.overlay-title{
  font-family:'Orbitron',monospace;
  font-size:clamp(28px,5vw,42px);
  font-weight:900;
  letter-spacing:6px;
  margin-bottom:8px;
}
.overlay-title.cyan{
  background:linear-gradient(135deg,var(--cyan),#80ffff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 20px rgba(0,240,255,0.4));
}
.overlay-title.purple{
  background:linear-gradient(135deg,var(--purple),#d8b4fe);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 20px rgba(168,85,247,0.4));
}
.overlay-title.gold{
  background:linear-gradient(135deg,var(--gold),#fbbf24);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  filter:drop-shadow(0 0 20px rgba(245,158,11,0.4));
}
.overlay-subtitle{
  font-family:'Rajdhani',sans-serif;
  font-size:18px;
  color:var(--text-dim);
  letter-spacing:2px;
  margin-bottom:28px;
}
.overlay-btn{
  display:inline-block;
  padding:14px 36px;
  margin:6px;
  background:linear-gradient(135deg,rgba(0,240,255,0.12),rgba(168,85,247,0.12));
  border:1px solid rgba(0,240,255,0.25);
  border-radius:12px;
  color:var(--cyan);
  font-family:'Orbitron',monospace;
  font-size:13px;font-weight:600;
  letter-spacing:2px;
  text-transform:uppercase;
  cursor:pointer;
  transition:all 0.3s;
  text-decoration:none;
}
.overlay-btn:hover{
  background:linear-gradient(135deg,rgba(0,240,255,0.22),rgba(168,85,247,0.22));
  box-shadow:0 0 24px rgba(0,240,255,0.25);
  transform:translateY(-2px);
}

/* Status bar */
.status-bar{
  position:relative;z-index:10;
  font-family:'Rajdhani',sans-serif;
  font-size:14px;
  font-weight:500;
  letter-spacing:1px;
  color:var(--text-dim);
  text-align:center;
  padding:6px 16px;
  min-height:28px;
}
.status-bar.cyan-turn{color:var(--cyan)}
.status-bar.purple-turn{color:var(--purple)}
.status-bar.gold-status{color:var(--gold)}

/* ===== RESPONSIVE ===== */
@media(max-width:900px){
  .game-wrapper{
    flex-direction:column;
    align-items:center;
  }
  .side-panel{
    width:100%;
    max-width:400px;
    flex-direction:row;
    flex-wrap:wrap;
    gap:8px;
  }
  .side-panel .panel-box{
    flex:1;
    min-width:140px;
  }
}
@media(max-width:500px){
  .board{
    width:clamp(260px,88vw,400px);
    height:clamp(260px,88vw,400px);
  }
  .board-frame{padding:8px;border-radius:14px}
  .side-panel .panel-box{padding:10px 12px}
  .header{padding:12px 16px}
  .title-section{margin-top:16px}
}
</style>
</head>
<body>

<!-- Starfield -->
<div class="starfield" id="starfield"></div>
<div class="scanlines"></div>

<!-- Header -->
<header class="header">
  <a href="/games.html" class="back-link">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
    ARCADE
  </a>
  <div class="header-brand">NEON <span>TACTICS</span></div>
</header>

<!-- Title -->
<div class="title-section">
  <div class="title-main">CHECKERS</div>
  <div class="title-sub">NEON TACTICS</div>
</div>

<!-- Status -->
<div class="status-bar" id="statusBar">Select a piece to begin</div>

<!-- Game area -->
<div class="game-wrapper">

  <!-- Left Panel -->
  <div class="side-panel">
    <div class="panel-box">
      <div class="panel-title">Current Turn</div>
      <div class="turn-indicator" id="turnIndicator">
        <div class="turn-disc cyan" id="turnDisc"></div>
        <div class="turn-text cyan" id="turnText">YOUR TURN</div>
      </div>
    </div>

    <div class="panel-box">
      <div class="panel-title">Score</div>
      <div class="score-display">
        <div class="score-val cyan-s" id="playerScore">12</div>
        <div class="score-vs">VS</div>
        <div class="score-val purple-s" id="aiScore">12</div>
      </div>
    </div>

    <div class="panel-box">
      <div class="panel-title">Captured</div>
      <div style="font-size:11px;color:var(--cyan);margin-bottom:4px;letter-spacing:1px">YOU CAPTURED</div>
      <div class="captured-row" id="playerCaptured"></div>
      <div style="font-size:11px;color:var(--purple);margin:8px 0 4px;letter-spacing:1px">AI CAPTURED</div>
      <div class="captured-row" id="aiCaptured"></div>
    </div>
  </div>

  <!-- Board -->
  <div class="board-container">
    <div class="board-frame">
      <div class="board-with-labels">
        <div class="board-labels-col" id="rowLabels"></div>
        <div>
          <div class="board" id="board"></div>
          <div class="board-bottom-labels" id="colLabels"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Panel -->
  <div class="side-panel">
    <div class="panel-box">
      <div class="panel-title">Game Mode</div>
      <button class="mode-btn active" id="modeAI" onclick="setMode('ai')">VS AI</button>
      <button class="mode-btn" id="modePlayer" onclick="setMode('player')" style="margin-top:6px">VS PLAYER</button>
    </div>
    <div class="panel-box" id="diffPanel">
      <div class="panel-title">AI Difficulty</div>
      <div class="diff-btns">
        <button class="diff-btn" id="diffEasy" onclick="setDifficulty(1)">Easy</button>
        <button class="diff-btn active" id="diffMed" onclick="setDifficulty(3)">Med</button>
        <button class="diff-btn" id="diffHard" onclick="setDifficulty(5)">Hard</button>
      </div>
    </div>
    <div class="panel-box">
      <button class="new-game-btn" onclick="resetGame()">NEW GAME</button>
    </div>
  </div>
</div>

<!-- Win overlay -->
<div class="overlay" id="winOverlay">
  <div class="overlay-box">
    <div class="overlay-title" id="winTitle">VICTORY</div>
    <div class="overlay-subtitle" id="winSubtitle">You dominated the board!</div>
    <button class="overlay-btn" onclick="resetGame()">PLAY AGAIN</button>
    <a href="/games.html" class="overlay-btn" style="border-color:rgba(168,85,247,0.25);color:var(--purple)">ARCADE</a>
  </div>
</div>

<script>
// ===== STARFIELD =====
(function(){
  const sf=document.getElementById('starfield');
  for(let i=0;i<120;i++){
    const s=document.createElement('div');
    s.className='star';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*100+'%';
    s.style.setProperty('--dur',(3+Math.random()*5)+'s');
    s.style.setProperty('--max-o',0.3+Math.random()*0.6);
    s.style.animationDelay=(-Math.random()*5)+'s';
    if(Math.random()<0.15){
      s.style.width='3px';s.style.height='3px';
      s.style.background=Math.random()<0.5?'#00f0ff':'#a855f7';
    }
    sf.appendChild(s);
  }
  // Nebulas
  const nColors=['#00f0ff','#a855f7','#f59e0b'];
  for(let i=0;i<3;i++){
    const n=document.createElement('div');
    n.className='nebula';
    n.style.width=(200+Math.random()*250)+'px';
    n.style.height=(200+Math.random()*250)+'px';
    n.style.left=Math.random()*80+'%';
    n.style.top=Math.random()*80+'%';
    n.style.background=nColors[i];
    n.style.animationDelay=(-Math.random()*15)+'s';
    sf.appendChild(n);
  }
})();

// ===== AUDIO ENGINE =====
const AudioEngine={
  ctx:null,
  init(){
    if(!this.ctx)this.ctx=new(window.AudioContext||window.webkitAudioContext)();
  },
  play(type){
    this.init();
    const c=this.ctx;
    const now=c.currentTime;
    const g=c.createGain();
    g.connect(c.destination);
    if(type==='move'){
      const o=c.createOscillator();
      o.type='sine';o.frequency.setValueAtTime(600,now);
      o.frequency.exponentialRampToValueAtTime(800,now+0.08);
      g.gain.setValueAtTime(0.12,now);
      g.gain.exponentialRampToValueAtTime(0.001,now+0.12);
      o.connect(g);o.start(now);o.stop(now+0.12);
    }else if(type==='capture'){
      const o=c.createOscillator();
      o.type='sawtooth';o.frequency.setValueAtTime(300,now);
      o.frequency.exponentialRampToValueAtTime(100,now+0.2);
      g.gain.setValueAtTime(0.15,now);
      g.gain.exponentialRampToValueAtTime(0.001,now+0.25);
      o.connect(g);o.start(now);o.stop(now+0.25);
      // Impact
      const o2=c.createOscillator();
      const g2=c.createGain();g2.connect(c.destination);
      o2.type='square';o2.frequency.setValueAtTime(150,now);
      o2.frequency.exponentialRampToValueAtTime(50,now+0.15);
      g2.gain.setValueAtTime(0.1,now);
      g2.gain.exponentialRampToValueAtTime(0.001,now+0.18);
      o2.connect(g2);o2.start(now);o2.stop(now+0.18);
    }else if(type==='king'){
      [523,659,784].forEach((f,i)=>{
        const o=c.createOscillator();
        const gn=c.createGain();gn.connect(c.destination);
        o.type='sine';o.frequency.setValueAtTime(f,now+i*0.1);
        gn.gain.setValueAtTime(0.12,now+i*0.1);
        gn.gain.exponentialRampToValueAtTime(0.001,now+i*0.1+0.25);
        o.connect(gn);o.start(now+i*0.1);o.stop(now+i*0.1+0.25);
      });
    }else if(type==='win'){
      [523,659,784,1047].forEach((f,i)=>{
        const o=c.createOscillator();
        const gn=c.createGain();gn.connect(c.destination);
        o.type='sine';o.frequency.setValueAtTime(f,now+i*0.15);
        gn.gain.setValueAtTime(0.14,now+i*0.15);
        gn.gain.exponentialRampToValueAtTime(0.001,now+i*0.15+0.4);
        o.connect(gn);o.start(now+i*0.15);o.stop(now+i*0.15+0.4);
      });
    }else if(type==='select'){
      const o=c.createOscillator();
      o.type='sine';o.frequency.setValueAtTime(1000,now);
      o.frequency.exponentialRampToValueAtTime(1200,now+0.06);
      g.gain.setValueAtTime(0.08,now);
      g.gain.exponentialRampToValueAtTime(0.001,now+0.08);
      o.connect(g);o.start(now);o.stop(now+0.08);
    }
  }
};

// ===== PARTICLE SYSTEM =====
function spawnParticles(x,y,color,count=12){
  const board=document.getElementById('board');
  const rect=board.getBoundingClientRect();
  for(let i=0;i<count;i++){
    const p=document.createElement('div');
    p.className='particle';
    const size=3+Math.random()*5;
    p.style.width=size+'px';
    p.style.height=size+'px';
    p.style.background=color;
    p.style.boxShadow=`0 0 ${size*2}px ${color}`;
    p.style.left=(x-rect.left)+'px';
    p.style.top=(y-rect.top)+'px';
    board.appendChild(p);
    const angle=Math.random()*Math.PI*2;
    const speed=40+Math.random()*80;
    const dx=Math.cos(angle)*speed;
    const dy=Math.sin(angle)*speed;
    let ox=0,oy=0,op=1;
    const startTime=performance.now();
    function animP(t){
      const elapsed=(t-startTime)/1000;
      if(elapsed>0.6){p.remove();return;}
      ox+=dx*0.016;oy+=dy*0.016;
      op=1-elapsed/0.6;
      p.style.transform=`translate(${ox}px,${oy}px) scale(${op})`;
      p.style.opacity=op;
      requestAnimationFrame(animP);
    }
    requestAnimationFrame(animP);
  }
}

// ===== GAME STATE =====
const EMPTY=0,PLAYER=1,AI=2,PLAYER_KING=3,AI_KING=4;

let board=[];
let selectedPiece=null;
let validMoves=[];
let gameMode='ai'; // 'ai' or 'player'
let aiDepth=3;
let currentTurn=PLAYER;
let playerCaptured=0,aiCaptured=0;
let isAnimating=false;
let gameOver=false;
let mustJumpFrom=null; // for multi-jump

function isPlayer(p){return p===PLAYER||p===PLAYER_KING}
function isAI(p){return p===AI||p===AI_KING}
function isKing(p){return p===PLAYER_KING||p===AI_KING}
function owner(p){return isPlayer(p)?PLAYER:isAI(p)?AI:EMPTY}

// Board labels
(function(){
  const rl=document.getElementById('rowLabels');
  const cl=document.getElementById('colLabels');
  for(let i=0;i<8;i++){
    const d=document.createElement('div');
    d.className='board-label';
    d.textContent=8-i;
    d.style.flex='1';
    d.style.display='flex';
    d.style.alignItems='center';
    d.style.justifyContent='center';
    rl.appendChild(d);
  }
  for(let i=0;i<8;i++){
    const d=document.createElement('div');
    d.className='board-label';
    d.textContent=String.fromCharCode(65+i);
    d.style.flex='1';
    cl.appendChild(d);
  }
})();

function initBoard(){
  board=[];
  for(let r=0;r<8;r++){
    board[r]=[];
    for(let c=0;c<8;c++){
      if((r+c)%2===1){
        if(r<3)board[r][c]=AI;
        else if(r>4)board[r][c]=PLAYER;
        else board[r][c]=EMPTY;
      }else{
        board[r][c]=EMPTY;
      }
    }
  }
}

function renderBoard(){
  const el=document.getElementById('board');
  el.innerHTML='';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell=document.createElement('div');
      cell.className='cell '+((r+c)%2===0?'light':'dark');
      cell.dataset.row=r;
      cell.dataset.col=c;

      if((r+c)%2===1){
        cell.classList.add('playable');
        // Check if valid move
        const isValid=validMoves.some(m=>m.toR===r&&m.toC===c);
        const isCapture=validMoves.some(m=>m.toR===r&&m.toC===c&&m.captures&&m.captures.length>0);
        if(isValid){
          cell.classList.add('valid-move');
          if(isCapture)cell.classList.add('valid-capture');
        }
        cell.addEventListener('click',()=>onCellClick(r,c));
        cell.addEventListener('touchend',(e)=>{e.preventDefault();onCellClick(r,c);});
      }

      // Piece
      const p=board[r][c];
      if(p!==EMPTY){
        const piece=document.createElement('div');
        piece.className='piece';
        if(isPlayer(p))piece.classList.add('player');
        if(isAI(p))piece.classList.add('ai');
        if(isKing(p))piece.classList.add('king');
        if(selectedPiece&&selectedPiece.r===r&&selectedPiece.c===c){
          piece.classList.add('selected');
        }
        piece.addEventListener('click',(e)=>{e.stopPropagation();onPieceClick(r,c);});
        piece.addEventListener('touchend',(e)=>{e.preventDefault();e.stopPropagation();onPieceClick(r,c);});
        cell.appendChild(piece);
      }

      el.appendChild(cell);
    }
  }
}

function getJumps(boardState,r,c){
  const p=boardState[r][c];
  if(p===EMPTY)return[];
  const jumps=[];
  const dirs=[];
  if(isPlayer(p)||isKing(p)){dirs.push([-1,-1],[-1,1]);}
  if(isAI(p)||isKing(p)){dirs.push([1,-1],[1,1]);}

  for(const[dr,dc] of dirs){
    const mr=r+dr,mc=c+dc;
    const jr=r+2*dr,jc=c+2*dc;
    if(jr>=0&&jr<8&&jc>=0&&jc<8){
      const mid=boardState[mr][mc];
      if(mid!==EMPTY&&owner(mid)!==owner(p)&&boardState[jr][jc]===EMPTY){
        jumps.push({fromR:r,fromC:c,toR:jr,toC:jc,captures:[{r:mr,c:mc}]});
      }
    }
  }
  return jumps;
}

function getSimpleMoves(boardState,r,c){
  const p=boardState[r][c];
  if(p===EMPTY)return[];
  const moves=[];
  const dirs=[];
  if(isPlayer(p)||isKing(p)){dirs.push([-1,-1],[-1,1]);}
  if(isAI(p)||isKing(p)){dirs.push([1,-1],[1,1]);}

  for(const[dr,dc] of dirs){
    const nr=r+dr,nc=c+dc;
    if(nr>=0&&nr<8&&nc>=0&&nc<8&&boardState[nr][nc]===EMPTY){
      moves.push({fromR:r,fromC:c,toR:nr,toC:nc,captures:[]});
    }
  }
  return moves;
}

function getAllMovesForSide(boardState,side){
  let allJumps=[],allSimple=[];
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      if(boardState[r][c]!==EMPTY&&owner(boardState[r][c])===side){
        const jumps=getJumps(boardState,r,c);
        allJumps.push(...jumps);
        const simple=getSimpleMoves(boardState,r,c);
        allSimple.push(...simple);
      }
    }
  }
  // Mandatory jumps
  if(allJumps.length>0)return allJumps;
  return allSimple;
}

function hasJumps(boardState,side){
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      if(boardState[r][c]!==EMPTY&&owner(boardState[r][c])===side){
        if(getJumps(boardState,r,c).length>0)return true;
      }
    }
  }
  return false;
}

function applyMove(boardState,move){
  const ns=boardState.map(row=>[...row]);
  const p=ns[move.fromR][move.fromC];
  ns[move.fromR][move.fromC]=EMPTY;
  ns[move.toR][move.toC]=p;
  // Remove captured
  for(const cap of move.captures){
    ns[cap.r][cap.c]=EMPTY;
  }
  // King promotion
  if(isPlayer(p)&&move.toR===0)ns[move.toR][move.toC]=PLAYER_KING;
  if(isAI(p)&&move.toR===7)ns[move.toR][move.toC]=AI_KING;
  return ns;
}

function countPieces(boardState,side){
  let n=0;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++)
    if(boardState[r][c]!==EMPTY&&owner(boardState[r][c])===side)n++;
  return n;
}

// ===== UI UPDATES =====
function updateTurnIndicator(){
  const disc=document.getElementById('turnDisc');
  const text=document.getElementById('turnText');
  const bar=document.getElementById('statusBar');

  if(currentTurn===PLAYER){
    disc.className='turn-disc cyan';
    text.className='turn-text cyan';
    if(gameMode==='player'){
      text.textContent='CYAN TURN';
      bar.textContent='Cyan player\'s turn';
      bar.className='status-bar cyan-turn';
    }else{
      text.textContent='YOUR TURN';
      bar.textContent='Select a piece to move';
      bar.className='status-bar cyan-turn';
    }
  }else{
    disc.className='turn-disc purple';
    text.className='turn-text purple';
    if(gameMode==='player'){
      text.textContent='PURPLE TURN';
      bar.textContent='Purple player\'s turn';
      bar.className='status-bar purple-turn';
    }else{
      text.textContent='AI THINKING';
      bar.textContent='AI is calculating...';
      bar.className='status-bar purple-turn';
    }
  }
}

function updateScores(){
  document.getElementById('playerScore').textContent=countPieces(board,PLAYER);
  document.getElementById('aiScore').textContent=countPieces(board,AI);
}

function updateCapturedDisplay(){
  const pc=document.getElementById('playerCaptured');
  const ac=document.getElementById('aiCaptured');
  pc.innerHTML='';ac.innerHTML='';
  for(let i=0;i<playerCaptured;i++){
    const d=document.createElement('div');
    d.className='captured-piece purple-cap';
    pc.appendChild(d);
  }
  for(let i=0;i<aiCaptured;i++){
    const d=document.createElement('div');
    d.className='captured-piece cyan-cap';
    ac.appendChild(d);
  }
}

// ===== CLICK HANDLERS =====
function onPieceClick(r,c){
  if(isAnimating||gameOver)return;
  if(gameMode==='ai'&&currentTurn===AI)return;

  const p=board[r][c];
  const side=currentTurn;

  if(owner(p)!==side)return;

  // If must jump from specific piece (multi-jump)
  if(mustJumpFrom&&(mustJumpFrom.r!==r||mustJumpFrom.c!==c))return;

  AudioEngine.play('select');

  selectedPiece={r,c};

  // Calculate valid moves for this piece
  const allMoves=getAllMovesForSide(board,side);
  const hasJumpsForSide=allMoves.some(m=>m.captures.length>0);

  validMoves=allMoves.filter(m=>m.fromR===r&&m.fromC===c);

  // If there are jumps available globally but not for this piece, show no moves
  if(hasJumpsForSide){
    validMoves=validMoves.filter(m=>m.captures.length>0);
  }

  renderBoard();
}

function onCellClick(r,c){
  if(isAnimating||gameOver)return;
  if(gameMode==='ai'&&currentTurn===AI)return;

  // Check if clicking on own piece
  if(board[r][c]!==EMPTY&&owner(board[r][c])===currentTurn){
    onPieceClick(r,c);
    return;
  }

  if(!selectedPiece)return;

  const move=validMoves.find(m=>m.toR===r&&m.toC===c);
  if(!move)return;

  executeMove(move);
}

function executeMove(move){
  isAnimating=true;
  const piece=board[move.fromR][move.fromC];
  const wasCapture=move.captures.length>0;

  // Animate
  animateMove(move,()=>{
    // Apply
    board=applyMove(board,move);

    // Track captures
    if(wasCapture){
      if(owner(piece)===PLAYER){
        playerCaptured+=move.captures.length;
      }else{
        aiCaptured+=move.captures.length;
      }
    }

    // Check for king promotion
    const destPiece=board[move.toR][move.toC];
    const wasKingBefore=isKing(piece);
    const isKingNow=isKing(destPiece);
    if(!wasKingBefore&&isKingNow){
      AudioEngine.play('king');
      setStatus('CROWNED! Piece promoted to King!','gold-status');
    }

    // Sound
    if(wasCapture)AudioEngine.play('capture');
    else AudioEngine.play('move');

    updateScores();
    updateCapturedDisplay();

    // Check multi-jump
    if(wasCapture){
      const moreJumps=getJumps(board,move.toR,move.toC);
      // If promoted to king this turn, no multi-jump in standard checkers
      if(moreJumps.length>0&&!(!wasKingBefore&&isKingNow)){
        mustJumpFrom={r:move.toR,c:move.toC};
        selectedPiece={r:move.toR,c:move.toC};
        validMoves=moreJumps;
        isAnimating=false;
        renderBoard();
        setStatus('Multi-jump! Continue capturing','gold-status');
        return;
      }
    }

    mustJumpFrom=null;
    selectedPiece=null;
    validMoves=[];

    // Check win
    if(checkWin()){
      isAnimating=false;
      renderBoard();
      return;
    }

    // Switch turn
    currentTurn=currentTurn===PLAYER?AI:PLAYER;
    updateTurnIndicator();
    isAnimating=false;
    renderBoard();

    // AI turn
    if(gameMode==='ai'&&currentTurn===AI&&!gameOver){
      setTimeout(doAITurn,500);
    }
  });
}

function animateMove(move,callback){
  const boardEl=document.getElementById('board');
  const cells=boardEl.querySelectorAll('.cell');
  const fromIdx=move.fromR*8+move.fromC;
  const toIdx=move.toR*8+move.toC;

  const fromCell=cells[fromIdx];
  const toCell=cells[toIdx];
  const pieceEl=fromCell.querySelector('.piece');

  if(!pieceEl){callback();return;}

  const fromRect=fromCell.getBoundingClientRect();
  const toRect=toCell.getBoundingClientRect();
  const boardRect=boardEl.getBoundingClientRect();

  // Create floating piece
  const floater=pieceEl.cloneNode(true);
  floater.classList.remove('selected');
  floater.classList.add('moving');
  floater.style.position='absolute';
  floater.style.width=pieceEl.offsetWidth+'px';
  floater.style.height=pieceEl.offsetHeight+'px';
  floater.style.left=(fromRect.left-boardRect.left+(fromRect.width-pieceEl.offsetWidth)/2)+'px';
  floater.style.top=(fromRect.top-boardRect.top+(fromRect.height-pieceEl.offsetHeight)/2)+'px';
  floater.style.zIndex='20';
  boardEl.style.position='relative';
  boardEl.appendChild(floater);

  // Hide original
  pieceEl.style.visibility='hidden';

  // Remove captured pieces mid-animation
  if(move.captures.length>0){
    setTimeout(()=>{
      for(const cap of move.captures){
        const capIdx=cap.r*8+cap.c;
        const capCell=cells[capIdx];
        const capPiece=capCell.querySelector('.piece');
        if(capPiece){
          const capRect=capCell.getBoundingClientRect();
          spawnParticles(
            capRect.left+capRect.width/2,
            capRect.top+capRect.height/2,
            isPlayer(board[cap.r][cap.c])?'#00f0ff':'#a855f7',
            16
          );
          capPiece.style.transition='transform 0.2s,opacity 0.2s';
          capPiece.style.transform='scale(0)';
          capPiece.style.opacity='0';
        }
      }
    },120);
  }

  // Animate to target
  requestAnimationFrame(()=>{
    floater.style.left=(toRect.left-boardRect.left+(toRect.width-pieceEl.offsetWidth)/2)+'px';
    floater.style.top=(toRect.top-boardRect.top+(toRect.height-pieceEl.offsetHeight)/2)+'px';
  });

  setTimeout(()=>{
    floater.remove();
    callback();
  },350);
}

function setStatus(msg,cls){
  const bar=document.getElementById('statusBar');
  bar.textContent=msg;
  bar.className='status-bar '+(cls||'');
}

function checkWin(){
  const playerPieces=countPieces(board,PLAYER);
  const aiPieces=countPieces(board,AI);
  const playerMoves=getAllMovesForSide(board,PLAYER);
  const aiMoves=getAllMovesForSide(board,AI);

  if(aiPieces===0||aiMoves.length===0){
    gameOver=true;
    showWin(PLAYER);
    return true;
  }
  if(playerPieces===0||playerMoves.length===0){
    gameOver=true;
    showWin(AI);
    return true;
  }
  return false;
}

function showWin(winner){
  AudioEngine.play('win');
  const ov=document.getElementById('winOverlay');
  const title=document.getElementById('winTitle');
  const sub=document.getElementById('winSubtitle');

  if(winner===PLAYER){
    if(gameMode==='ai'){
      title.textContent='VICTORY';
      title.className='overlay-title cyan';
      sub.textContent='You defeated the AI! Brilliant tactics!';
    }else{
      title.textContent='CYAN WINS';
      title.className='overlay-title cyan';
      sub.textContent='Cyan player dominates the board!';
    }
  }else{
    if(gameMode==='ai'){
      title.textContent='DEFEATED';
      title.className='overlay-title purple';
      sub.textContent='The AI outplayed you. Try again!';
    }else{
      title.textContent='PURPLE WINS';
      title.className='overlay-title purple';
      sub.textContent='Purple player dominates the board!';
    }
  }

  ov.classList.add('active');
}

// ===== AI (Minimax with Alpha-Beta) =====
function evaluateBoard(boardState){
  let score=0;
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const p=boardState[r][c];
      if(p===EMPTY)continue;
      if(p===PLAYER){
        score-=10;
        score-=(7-r); // Advance bonus
        // Edge bonus
        if(c===0||c===7)score-=1;
      }else if(p===PLAYER_KING){
        score-=15;
        score-=2; // Center
      }else if(p===AI){
        score+=10;
        score+=r; // Advance bonus
        if(c===0||c===7)score+=1;
      }else if(p===AI_KING){
        score+=15;
        score+=2;
      }
    }
  }
  // Mobility
  const aiMoves=getAllMovesForSide(boardState,AI).length;
  const plMoves=getAllMovesForSide(boardState,PLAYER).length;
  score+=(aiMoves-plMoves)*0.5;
  return score;
}

function minimax(boardState,depth,alpha,beta,maximizing){
  if(depth===0){
    return{score:evaluateBoard(boardState),move:null};
  }

  const side=maximizing?AI:PLAYER;
  const moves=getAllMovesForSide(boardState,side);

  if(moves.length===0){
    // Side has no moves = loses
    return{score:maximizing?-1000:1000,move:null};
  }

  let bestMove=null;

  if(maximizing){
    let maxEval=-Infinity;
    for(const move of moves){
      // For jumps, expand multi-jumps
      const newBoard=applyMove(boardState,move);
      let fullMove=move;

      // Check multi-jump
      let expanded=expandMultiJump(newBoard,move,side);

      const ev=minimax(expanded.board,depth-1,alpha,beta,false);
      if(ev.score>maxEval){
        maxEval=ev.score;
        bestMove=expanded.fullMove||move;
      }
      alpha=Math.max(alpha,ev.score);
      if(beta<=alpha)break;
    }
    return{score:maxEval,move:bestMove};
  }else{
    let minEval=Infinity;
    for(const move of moves){
      const newBoard=applyMove(boardState,move);
      let expanded=expandMultiJump(newBoard,move,side);

      const ev=minimax(expanded.board,depth-1,alpha,beta,true);
      if(ev.score<minEval){
        minEval=ev.score;
        bestMove=expanded.fullMove||move;
      }
      beta=Math.min(beta,ev.score);
      if(beta<=alpha)break;
    }
    return{score:minEval,move:bestMove};
  }
}

function expandMultiJump(boardState,move,side){
  // After a capture, check for additional jumps from landing square
  if(move.captures.length===0)return{board:boardState,fullMove:move};

  const p=boardState[move.toR][move.toC];
  // Don't multi-jump if piece was just promoted
  const origPiece=isKing(p)&&!isKing(move.captures.length>0?AI:PLAYER);

  const moreJumps=getJumps(boardState,move.toR,move.toC);
  if(moreJumps.length===0)return{board:boardState,fullMove:move};

  // Pick best continuation greedily for the AI minimax
  let best=null,bestScore=side===AI?-Infinity:Infinity;
  for(const j of moreJumps){
    const nb=applyMove(boardState,j);
    const sc=evaluateBoard(nb);
    if(side===AI&&sc>bestScore){bestScore=sc;best={board:nb,jump:j};}
    if(side===PLAYER&&sc<bestScore){bestScore=sc;best={board:nb,jump:j};}
  }
  if(best){
    // Recurse
    return expandMultiJump(best.board,best.jump,side);
  }
  return{board:boardState,fullMove:move};
}

function doAITurn(){
  if(gameOver)return;
  isAnimating=true;
  updateTurnIndicator();

  setTimeout(()=>{
    const result=minimax(board,aiDepth,-Infinity,Infinity,true);
    if(!result.move){
      // AI has no moves
      gameOver=true;
      showWin(PLAYER);
      isAnimating=false;
      return;
    }
    executeAIMove(result.move);
  },100);
}

function executeAIMove(move){
  // For AI, we execute the move step by step (including multi-jumps)
  const piece=board[move.fromR][move.fromC];
  const wasCapture=move.captures.length>0;

  animateMove(move,()=>{
    board=applyMove(board,move);

    if(wasCapture){
      aiCaptured+=move.captures.length;
      AudioEngine.play('capture');
    }else{
      AudioEngine.play('move');
    }

    // Check king
    const destPiece=board[move.toR][move.toC];
    const wasKingBefore=isKing(piece);
    const isKingNow=isKing(destPiece);
    if(!wasKingBefore&&isKingNow){
      AudioEngine.play('king');
    }

    updateScores();
    updateCapturedDisplay();

    // Multi-jump for AI
    if(wasCapture&&!(!wasKingBefore&&isKingNow)){
      const moreJumps=getJumps(board,move.toR,move.toC);
      if(moreJumps.length>0){
        // Pick best jump
        let best=null,bestScore=-Infinity;
        for(const j of moreJumps){
          const nb=applyMove(board,j);
          const sc=evaluateBoard(nb);
          if(sc>bestScore){bestScore=sc;best=j;}
        }
        if(best){
          selectedPiece=null;
          validMoves=[];
          renderBoard();
          setTimeout(()=>executeAIMove(best),300);
          return;
        }
      }
    }

    selectedPiece=null;
    validMoves=[];
    mustJumpFrom=null;

    if(checkWin()){
      isAnimating=false;
      renderBoard();
      return;
    }

    currentTurn=PLAYER;
    updateTurnIndicator();
    isAnimating=false;
    renderBoard();
  });
}

// ===== CONTROLS =====
function setMode(mode){
  gameMode=mode;
  document.getElementById('modeAI').classList.toggle('active',mode==='ai');
  document.getElementById('modePlayer').classList.toggle('active',mode==='player');
  document.getElementById('diffPanel').style.display=mode==='ai'?'block':'none';
  resetGame();
}

function setDifficulty(depth){
  aiDepth=depth;
  document.getElementById('diffEasy').classList.toggle('active',depth===1);
  document.getElementById('diffMed').classList.toggle('active',depth===3);
  document.getElementById('diffHard').classList.toggle('active',depth===5);
  resetGame();
}

function resetGame(){
  gameOver=false;
  selectedPiece=null;
  validMoves=[];
  mustJumpFrom=null;
  playerCaptured=0;
  aiCaptured=0;
  currentTurn=PLAYER;
  isAnimating=false;

  document.getElementById('winOverlay').classList.remove('active');

  initBoard();
  updateScores();
  updateCapturedDisplay();
  updateTurnIndicator();
  renderBoard();
}

// ===== INIT =====
initBoard();
updateScores();
updateCapturedDisplay();
updateTurnIndicator();
renderBoard();
</script>
</body>
</html>
